#!/bin/bash

echo "üßπ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–ß–ò–°–¢–ö–ê: –£–¥–∞–ª–µ–Ω–∏–µ malware –∏–∑ —Å–∏—Å—Ç–µ–º—ã..."

echo "‚ö†Ô∏è  –û–ë–ù–ê–†–£–ñ–ï–ù –ö–†–ò–ü–¢–û–ú–ê–ô–ù–ï–† KINSING!"
echo "   –°–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ç—Ä–µ–±—É–µ—Ç –æ—á–∏—Å—Ç–∫–∏"
echo ""

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üõë –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã..."
docker compose down

# –£–¥–∞–ª—è–µ–º –≤—Å–µ –æ–±—Ä–∞–∑—ã –∏ volumes
echo "üóëÔ∏è  –£–¥–∞–ª—è–µ–º –≤—Å–µ Docker –æ–±—Ä–∞–∑—ã –∏ volumes..."
docker system prune -a -f --volumes

# –£–¥–∞–ª—è–µ–º –≤—Å–µ Docker networks
echo "üåê –û—á–∏—â–∞–µ–º Docker networks..."
docker network prune -f

# –û—á–∏—â–∞–µ–º certbot –¥–∞–Ω–Ω—ã–µ (–º–æ–≥—É—Ç –±—ã—Ç—å —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω—ã)
echo "üßπ –û—á–∏—â–∞–µ–º certbot –¥–∞–Ω–Ω—ã–µ..."
rm -rf certbot/

# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑—ã —Å –Ω—É–ª—è
echo "üîÑ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –æ–±—Ä–∞–∑—ã —Å –Ω—É–ª—è..."
docker compose build --no-cache --pull

echo ""
echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –ø–∞–º—è—Ç–∏"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º—É –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –¥—Ä—É–≥–∏—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏"
echo "3. –û–±–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏ –∏ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞"
echo "4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo "5. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–Ω–æ–≤–∞"
echo ""
echo "‚ö†Ô∏è  –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:"
echo "- –û–±–Ω–æ–≤–∏—Ç–µ –≤—Å–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã"
echo "- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ /etc/crontab –∏ ~/.bashrc –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π"
echo "- –°–º–µ–Ω–∏—Ç–µ –≤—Å–µ –ø–∞—Ä–æ–ª–∏"
echo "- –í–∫–ª—é—á–∏—Ç–µ firewall –∏ –∑–∞–∫—Ä–æ–π—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–æ—Ä—Ç—ã"
echo ""

read -p "üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Å–µ–π—á–∞—Å? (y/N): " reboot_now
if [[ "$reboot_now" =~ ^[Yy]$ ]]; then
    echo "üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–∏—Å—Ç–µ–º—É..."
    sudo reboot
fi 