import{j as e}from"./ui-DmaJfU4R.js";import{r as s,L as E}from"./router-YsGj19cs.js";import{c as M}from"./index-Czdh4XVO.js";import{B as l}from"./button-CEL2MslA.js";import{u as X}from"./use-toast-BimaNeed.js";import{S as T,a as _,b as A,c as B,d as x}from"./select-DS8I4ch4.js";import{S as Z}from"./switch-DVYTxNX9.js";import{P as ee,a as te,b as se}from"./popover-S1_DSqif.js";import{L as h}from"./label-BnZhCuKw.js";import{C as ae}from"./constants-BN7_l00R.js";import{L as D}from"./loader-circle-yzSCNo-f.js";import{m as F}from"./proxy-OF6tZF67.js";import{C as re}from"./circle-plus-C0p9U_YC.js";import{P as ie}from"./pencil-sRn5a90G.js";import{T as le}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./createLucideIcon-BcwDLXBm.js";import"./check-Jm2HgjeV.js";const Pe=()=>{const[p,u]=s.useState([]),[N,b]=s.useState(!0),[w,S]=s.useState(!1),[y,a]=s.useState(1),[I,k]=s.useState(!0),[C,V]=s.useState(""),[g,$]=s.useState(""),[P,L]=s.useState(null),{toast:f}=X(),[c,z]=s.useState(void 0),[n,Q]=s.useState(""),[d,R]=s.useState(""),[j,W]=s.useState(!1),[G,H]=s.useState(!1),[o,Y]=s.useState(void 0),q=Array.from(new Set(p.map(t=>t.style).filter(Boolean))),O=async(t=1,i=!1,m)=>{try{i?S(!0):b(!0);const r={page:t};m&&(r.q=m),o&&(r.category=o),j&&(r.min_price=0),n&&(r.min_price=parseFloat(n)),d&&(r.max_price=parseFloat(d)),c&&c!=="all"&&(r.style=c);const v=await M.get("/api/outfits/",{params:r});u(U=>i?[...U,...v.data]:v.data),k(v.data.length===20)}catch{f({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить список образов"})}finally{b(!1),S(!1)}};s.useEffect(()=>{a(1),O(1,!1,g)},[g,o,n,d,j,c]),s.useEffect(()=>{y!==1&&O(y,!0,g)},[y]);const J=t=>{t.preventDefault(),a(1),u([]),k(!0),$(C)},K=async t=>{if(confirm("Вы уверены, что хотите удалить этот образ?")){L(t);try{await M.delete(`/api/outfits/${t}`),u(i=>i.filter(m=>m.id!==t)),f({title:"Успешно",description:"Образ успешно удален",className:"border-0 bg-green-500 text-white shadow-lg"})}catch{f({variant:"destructive",title:"Ошибка",description:"Не удалось удалить образ"})}finally{L(null)}}};return N?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(D,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Управление образами"}),e.jsxs("form",{onSubmit:J,className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Поиск по названию...",value:C,onChange:t=>V(t.target.value),className:"border rounded px-2 py-1"}),e.jsx(l,{type:"submit",children:"Поиск"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ee,{open:G,onOpenChange:H,children:[e.jsx(te,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Фильтры"})}),e.jsx(se,{className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"mb-1 block",children:"Категория"}),e.jsxs(T,{value:o||"all",onValueChange:t=>{Y(t==="all"?void 0:t),a(1)},children:[e.jsx(_,{children:e.jsx(A,{placeholder:"Все категории"})}),e.jsxs(B,{children:[e.jsx(x,{value:"all",children:"Все категории"}),Object.entries(ae).map(([t,i])=>e.jsx(x,{value:t,children:i},t))]})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"mb-1 block",children:"Стиль"}),e.jsxs(T,{value:c||"all",onValueChange:t=>{z(t==="all"?void 0:t),a(1)},children:[e.jsx(_,{children:e.jsx(A,{placeholder:"Все стили"})}),e.jsxs(B,{children:[e.jsx(x,{value:"all",children:"Все стили"}),q.map(t=>e.jsx(x,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(h,{htmlFor:"only-price-switch",children:"Только с ценой"}),e.jsx(Z,{id:"only-price-switch",checked:j,onCheckedChange:t=>{W(t),a(1)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"block",children:"Цена"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{placeholder:"От",value:n,onChange:t=>{Q(t.target.value),a(1)},type:"number",min:"0",className:"border rounded px-2 py-1 w-full"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{placeholder:"До",value:d,onChange:t=>{R(t.target.value),a(1)},type:"number",min:"0",className:"border rounded px-2 py-1 w-full"})})]})]})]})})]}),e.jsx(l,{asChild:!0,children:e.jsxs(E,{to:"/admin/outfits/new",className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Добавить образ"]})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-sm dark:border-gray-800 dark:bg-gray-950",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Название"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Стиль"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Цена"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-medium text-gray-700 dark:text-gray-300",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:p.length>0?p.map(t=>e.jsxs(F.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50/50 dark:hover:bg-gray-900/50",children:[e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100",children:t.id}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:t.style}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:t.total_price?`${t.total_price} ₽`:"-"}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",asChild:!0,className:"border-gray-300 dark:border-gray-700",children:e.jsxs(E,{to:`/admin/outfits/${t.id}/edit`,className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsx("span",{children:"Редактировать"})]})}),e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>K(t.id),disabled:P===t.id,className:"flex items-center gap-1",children:[P===t.id?e.jsx(D,{className:"h-3 w-3 animate-spin"}):e.jsx(le,{className:"h-3 w-3"}),e.jsx("span",{children:"Удалить"})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет доступных образов"})})})]})}),!N&&I&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(l,{onClick:()=>a(t=>t+1),disabled:w,children:w?"Загрузка...":"Загрузить ещё"})})]})};export{Pe as default};
