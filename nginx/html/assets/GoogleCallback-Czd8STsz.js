import{j as e}from"./ui-Cqf_O7uz.js";import{f,r as a}from"./router-YsGj19cs.js";import{c as h,s as x}from"./index-DUoZO1f1.js";import{L as g}from"./LoadingSpinner-BYuekY1W.js";import{B as p}from"./button-D4DJKXVl.js";import{c as w}from"./utils-CytzSlOG.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";const j=({message:s,onRetry:r,className:t})=>e.jsxs("div",{className:w("max-w-md text-center",t),children:[e.jsxs("div",{className:"mb-4 text-red-600",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("p",{className:"mt-2 font-medium",children:s})]}),r&&e.jsx(p,{onClick:r,variant:"outline",className:"mt-4",children:"Попробовать снова"})]}),G=()=>{const s=f(),[r,t]=a.useState(null),[i,n]=a.useState(!0);return a.useEffect(()=>{(async()=>{try{n(!0);const c=new URLSearchParams(window.location.search).get("code");if(!c)throw new Error("Authorization code not found");const l=await h.get("/api/auth/google/callback",{params:{code:c}}),{access_token:m,refresh_token:d,user:u}=l.data;x(m,d),localStorage.setItem("user",JSON.stringify(u)),window.location.href="/home"}catch(o){console.error("Google callback error:",o),t(o instanceof Error?o.message:"Произошла ошибка при входе через Google. Пожалуйста, попробуйте снова."),s("/login",{state:{error:"Не удалось войти через Google"},replace:!0})}finally{n(!1)}})()},[s]),i?e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx(g,{size:"lg"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Завершаем вход через Google..."})]}):r?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4",children:e.jsx(j,{message:r,onRetry:()=>window.location.reload()})}):null};export{G as default};
