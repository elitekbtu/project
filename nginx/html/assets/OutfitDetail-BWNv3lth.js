import{j as e}from"./ui-DmaJfU4R.js";import{g as G,f as J,r as c,L as x}from"./router-YsGj19cs.js";import{u as K,a as Q,W as X,c as w}from"./index-8jId_CL5.js";import{d as Y,a as Z,b as L,t as ee,c as se}from"./outfits-5_GSKzeO.js";import{B as m}from"./button-CEL2MslA.js";import{T as te}from"./textarea-x4CJyvYj.js";import{C as O,d as E,a as ae}from"./card-hWJdfOrY.js";import{B as ie}from"./badge-CMy5sMNA.js";import{S as u}from"./skeleton-rVL-utXS.js";import{M as I,R}from"./RatingStars-BNNIPRxT.js";import{categoryConfig as A}from"./OutfitBuilder-BvyxMHDq.js";import{I as re}from"./ItemImage-C9AFigSL.js";import{m as o}from"./proxy-OF6tZF67.js";import{c as le}from"./createLucideIcon-BcwDLXBm.js";import{C as b}from"./chevron-left-DxwJ_0o2.js";import{T as ne}from"./triangle-alert-NRRLLGg1.js";import{S as oe}from"./shopping-cart-BlvFNc12.js";import{H as F}from"./heart-DyjZq6UA.js";import{P as ce}from"./pencil-sRn5a90G.js";import{T as de}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./star-Cx7l4Pfa.js";import"./input-DSjIL0vM.js";import"./use-toast-BimaNeed.js";import"./search-DxfJQDsN.js";import"./arrow-left-CZ8lUGg0.js";import"./arrow-right-ovKko4mr.js";import"./x-DBAcYj4I.js";import"./shopping-bag-Din1qLo_.js";/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=le("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),qe=()=>{const{id:l}=G(),{user:d,isAdmin:v}=K();J();const[t,M]=c.useState(null),[B,D]=c.useState(!0),[k,g]=c.useState(null),[h,p]=c.useState([]),[f,C]=c.useState(""),[_,S]=c.useState(),[j,N]=c.useState(null),{addItem:H}=Q(),[T,$]=c.useState(!1);c.useEffect(()=>{l&&(async()=>{var a,n;try{const r=(await w.get(`/api/outfits/${l}`)).data;M(r);const y=await L(Number(l));p(y)}catch(i){console.error(i),((a=i.response)==null?void 0:a.status)===403?g("У вас нет доступа к этому образу"):((n=i.response)==null?void 0:n.status)===404?g("Образ не найден"):g("Произошла ошибка при загрузке образа")}finally{D(!1)}})()},[l]),c.useEffect(()=>{(async()=>{if(!(!l||!d))try{const a=await w.get("/api/outfits/favorites");N(a.data.some(n=>n.id===Number(l)))}catch{}})()},[l,d]);const P=async()=>{if(!(!l||d===null)){N(s=>!s);try{await ee(Number(l))}catch(s){N(a=>!a),console.error(s)}}},q=async()=>{if(!(!l||!f.trim()))try{const s=await se(Number(l),{content:f,rating:_});p([s,...h]),C(""),S(void 0)}catch(s){console.error(s)}},W=async()=>{if(t){$(!0);try{const s=[...t.tops||[],...t.bottoms||[],...t.footwear||[],...t.accessories||[],...t.fragrances||[]];await Promise.all(s.map(async a=>{try{const i=(await w.get(`/api/items/${a.id}`)).data,r=i.variants&&i.variants.length>0?i.variants[0]:void 0,y=(r==null?void 0:r.id)??a.id,V=(r==null?void 0:r.price)??i.price??0;await H({id:y,item_id:a.id,name:i.name,price:V,image_url:i.image_url,size:r==null?void 0:r.size,color:r==null?void 0:r.color,stock:r==null?void 0:r.stock,quantity:1})}catch(n){console.error(n)}}))}catch(s){console.error(s)}finally{$(!1)}}},z=c.useMemo(()=>t?A.map(s=>{const a=s.key,n=t[a],i=n&&n.length?n[0]:void 0;return(i==null?void 0:i.image_url)||null}):A.map(()=>null),[t]);if(B)return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(u,{className:"h-6 w-24 rounded-full"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(u,{className:"aspect-[4/5] rounded-xl"})}),e.jsxs("div",{className:"w-full md:w-1/2 space-y-6",children:[e.jsx(u,{className:"h-9 w-3/4 rounded-lg"}),e.jsx(u,{className:"h-5 w-1/2 rounded-lg"}),e.jsx(u,{className:"h-7 w-1/4 rounded-lg"}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(u,{className:"h-4 w-full rounded-lg"}),e.jsx(u,{className:"h-4 w-4/5 rounded-lg"}),e.jsx(u,{className:"h-4 w-3/4 rounded-lg"})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(u,{className:"h-12 flex-1 rounded-lg"}),e.jsx(u,{className:"h-12 w-12 rounded-lg"})]})]})]})]});if(k)return e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-16 text-center",children:[e.jsx(me,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-2xl font-semibold tracking-tight",children:"Нет доступа"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:k}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsx(m,{asChild:!0,variant:"outline",className:"rounded-full",children:e.jsxs(x,{to:"/outfits",children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Вернуться к моим образам"]})}),!d&&e.jsx(m,{asChild:!0,className:"rounded-full",children:e.jsx(x,{to:"/login",children:"Войти в систему"})})]})]});if(!t)return e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-16 text-center",children:[e.jsx(ne,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-2xl font-semibold tracking-tight",children:"Образ не найден"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Возможно, образ был удален или перемещен"}),e.jsx(m,{asChild:!0,variant:"outline",className:"rounded-full",children:e.jsxs(x,{to:"/outfits",children:[e.jsx(b,{className:"mr-2 h-4 w-4"}),"Вернуться к моим образам"]})})]});const U=[{label:"Верх",items:t.tops,key:"tops"},{label:"Низ",items:t.bottoms,key:"bottoms"},{label:"Обувь",items:t.footwear,key:"footwear"},{label:"Аксессуары",items:t.accessories,key:"accessories"},{label:"Ароматы",items:t.fragrances,key:"fragrances"}];return e.jsxs(e.Fragment,{children:[t&&e.jsxs(X,{children:[e.jsxs("title",{children:[t.name," — Образ в TRC"]}),e.jsx("meta",{name:"description",content:t.description||"Уникальный модный образ на платформе TRC."}),e.jsx("meta",{name:"keywords",content:`мода, образ, стиль, ${t.style||""}, купить`}),e.jsx("meta",{property:"og:title",content:t.name}),e.jsx("meta",{property:"og:description",content:t.description||""})]}),e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-8",children:[e.jsx(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-6",children:e.jsx(m,{asChild:!0,variant:"ghost",className:"pl-0 hover:bg-transparent",children:e.jsxs(x,{to:"/outfits",className:"flex items-center text-sm text-muted-foreground hover:text-foreground",children:[e.jsx(b,{className:"mr-1 h-4 w-4"}),"Назад к моим образам"]})})}),e.jsxs("div",{className:"mb-16 flex flex-col gap-8 md:flex-row md:gap-12",children:[e.jsx(o.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:e.jsx("div",{className:"aspect-[4/5] relative overflow-hidden rounded-xl bg-muted shadow-sm border",children:t.tryon_image_url?e.jsx("img",{src:t.tryon_image_url.startsWith("/")?`${window.location.origin}${t.tryon_image_url}`:t.tryon_image_url,alt:"Виртуальная примерка",className:"absolute inset-0 w-full h-full object-cover",onError:s=>{console.error("Ошибка загрузки изображения виртуальной примерки:",t.tryon_image_url),s.currentTarget.style.display="none";const a=s.currentTarget.parentElement;a&&(a.innerHTML=`
                      <img src="/maneken.jpg" alt="Манекен" class="absolute inset-0 w-full h-full object-contain" />
                      ${z.map((n,i)=>n?`<img src="${n}" alt="layer" class="absolute inset-0 w-full h-full object-contain" style="z-index: ${i+1}" />`:"").join("")}
                    `)}}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/maneken.jpg",alt:"Манекен",className:"absolute inset-0 w-full h-full object-contain"}),z.map((s,a)=>s?e.jsx("img",{src:s,alt:"layer",className:"absolute inset-0 w-full h-full object-contain",style:{zIndex:a+1}},a):null)]})})}),e.jsxs(o.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:[e.jsx("div",{className:"mb-4",children:e.jsx(ie,{variant:"outline",className:"text-xs capitalize mb-4",children:"Образ"})}),e.jsx("h1",{className:"mb-2 text-2xl sm:text-3xl font-bold tracking-tight",children:t.name}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-md bg-muted/80 p-2 sm:p-2.5 border border-border/50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Стиль"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:t.style})]}),t.total_price&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2 sm:p-2.5 border border-border/50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Стоимость"}),e.jsxs("p",{className:"text-sm font-medium leading-tight",children:[t.total_price.toLocaleString("ru-RU")," ₽"]})]})]}),t.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-2 font-medium text-base sm:text-lg",children:"Описание"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed text-sm sm:text-base",children:t.description})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(m,{size:"lg",className:"flex-1 rounded-lg shadow-sm hover:shadow-md transition-shadow w-full sm:w-auto",disabled:T,onClick:W,children:[e.jsx(oe,{className:"mr-2 w-4 h-4"}),T?"Добавление...":"Добавить в корзину"]}),e.jsx(m,{size:"lg",variant:j?"default":"outline",className:"rounded-lg px-3 shadow-sm hover:shadow-md transition-shadow w-full sm:w-auto",onClick:P,children:e.jsx(F,{className:`h-5 w-5 ${j?"fill-current":""}`,strokeWidth:j?2:1.5})}),d&&(String(d.id)===t.owner_id||v)&&e.jsx(m,{asChild:!0,size:"lg",variant:"outline",className:"rounded-lg px-3 shadow-sm hover:shadow-md transition-shadow w-full sm:w-auto",children:e.jsx(x,{to:`/outfits/${t.id}/edit`,children:e.jsx(ce,{className:"h-4 w-4"})})})]})]})]}),e.jsxs(o.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},className:"mb-16",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight mb-2",children:"Состав образа"})}),e.jsx("div",{className:"space-y-12",children:U.map(s=>s.items.length>0&&e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-medium text-foreground uppercase tracking-wider border-l-4 border-primary pl-4",children:s.label}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.items.map(a=>e.jsx(o.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:e.jsx(O,{className:"group overflow-hidden transition-all hover:shadow-lg border-0 shadow-sm rounded-lg",children:e.jsxs(x,{to:`/items/${a.id}`,className:"block",children:[e.jsx("div",{className:"relative aspect-square overflow-hidden",children:e.jsx(re,{src:a.image_url,alt:a.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105",fallbackClassName:"flex h-full w-full items-center justify-center bg-muted"})}),e.jsx(E,{className:"p-2 sm:p-3",children:e.jsx("h4",{className:"font-medium leading-tight line-clamp-2 text-xs sm:text-sm group-hover:text-primary transition-colors",title:a.name,children:a.name})})]})})},a.id))})]},s.key))})]}),e.jsxs(o.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.3},className:"mb-16",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Отзывы"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:h.length})]})]}),e.jsxs(o.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"mb-8 rounded-xl border p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-medium",children:"Оставить отзыв"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Ваша оценка"}),e.jsx(R,{value:_,onChange:S})]}),e.jsx(te,{placeholder:"Поделитесь своим мнением об этом образе...",value:f,onChange:s=>C(s.target.value),rows:4,className:"rounded-lg border-muted"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(m,{onClick:q,disabled:!f.trim(),className:"rounded-lg",children:"Отправить отзыв"})})]})]}),h.length===0?e.jsxs(o.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"rounded-xl border p-8 text-center shadow-sm",children:[e.jsx(I,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-lg font-medium",children:"Пока нет отзывов"}),e.jsx("p",{className:"text-muted-foreground",children:"Будьте первым, кто оставит отзыв об этом образе"})]}):e.jsx(o.ul,{className:"space-y-4",children:h.map(s=>e.jsx(o.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(O,{className:"overflow-hidden border-0 shadow-sm",children:[e.jsx(ae,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.user_name??"Пользователь"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]}),((d==null?void 0:d.id)===s.user_id||v)&&e.jsx(m,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 h-8 w-8 rounded-full",onClick:async()=>{if(l&&confirm("Удалить комментарий?"))try{await Y(Number(l),s.id),p(a=>a.filter(n=>n.id!==s.id))}catch(a){console.error(a)}},children:e.jsx(de,{className:"h-4 w-4"})})]})}),e.jsxs(E,{className:"pt-0",children:[s.rating!==void 0&&s.rating!==null&&e.jsx("div",{className:"mb-3",children:e.jsx(R,{value:s.rating})}),e.jsx("p",{className:"mb-4 whitespace-pre-line text-muted-foreground",children:s.content}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(m,{variant:"ghost",size:"sm",className:"flex items-center gap-2 rounded-full",onClick:async()=>{if(!(!l||!d))try{await Z(Number(l),s.id);const a=await L(Number(l));p(a)}catch(a){console.error(a)}},children:[e.jsx(F,{className:`h-4 w-4 ${s.likes>0?"fill-primary text-primary":""}`}),e.jsx("span",{children:s.likes})]})})]})]})},s.id))})]})]})]})};export{qe as default};
