var ee=Object.defineProperty;var te=(s,e,n)=>e in s?ee(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var J=(s,e,n)=>te(s,typeof e!="symbol"?e+"":e,n);import{j as a}from"./ui-DmaJfU4R.js";import{r as u,f as se}from"./router-YsGj19cs.js";import{w as ae,x as ne,u as re,b as oe,l as H,h as ie}from"./index-Czdh4XVO.js";import{B as F}from"./button-CEL2MslA.js";import{I as U}from"./input-DSjIL0vM.js";import{u as le}from"./use-toast-BimaNeed.js";import{f as ce}from"./outfits-C9xau8vZ.js";import{I as M}from"./ItemImage-C9AFigSL.js";import{S as de}from"./search-DxfJQDsN.js";import{S as ue}from"./star-Cx7l4Pfa.js";import{A as me}from"./arrow-left-CZ8lUGg0.js";import{A as fe}from"./arrow-right-ovKko4mr.js";import{X as ge}from"./x-DBAcYj4I.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./shopping-bag-Din1qLo_.js";import"./createLucideIcon-BcwDLXBm.js";function pe(){if(console&&console.warn){for(var s=arguments.length,e=new Array(s),n=0;n<s;n++)e[n]=arguments[n];z(e[0])&&(e[0]=`react-i18next:: ${e[0]}`),console.warn(...e)}}const Q={};function q(){for(var s=arguments.length,e=new Array(s),n=0;n<s;n++)e[n]=arguments[n];z(e[0])&&Q[e[0]]||(z(e[0])&&(Q[e[0]]=new Date),pe(...e))}const Y=(s,e)=>()=>{if(s.isInitialized)e();else{const n=()=>{setTimeout(()=>{s.off("initialized",n)},0),e()};s.on("initialized",n)}},W=(s,e,n)=>{s.loadNamespaces(e,Y(s,n))},X=(s,e,n,f)=>{z(n)&&(n=[n]),n.forEach(y=>{s.options.ns.indexOf(y)<0&&s.options.ns.push(y)}),s.loadLanguages(e,Y(s,f))},he=function(s,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const f=e.languages[0],y=e.options?e.options.fallbackLng:!1,r=e.languages[e.languages.length-1];if(f.toLowerCase()==="cimode")return!0;const h=(E,I)=>{const d=e.services.backendConnector.state[`${E}|${I}`];return d===-1||d===2};return n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&e.services.backendConnector.backend&&e.isLanguageChangingTo&&!h(e.isLanguageChangingTo,s)?!1:!!(e.hasResourceBundle(f,s)||!e.services.backendConnector.backend||e.options.resources&&!e.options.partialBundledLanguages||h(f,s)&&(!y||h(r,s)))},xe=function(s,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return!e.languages||!e.languages.length?(q("i18n.languages were undefined or empty",e.languages),!0):e.options.ignoreJSONStructure!==void 0?e.hasLoadedNamespace(s,{lng:n.lng,precheck:(y,r)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&y.services.backendConnector.backend&&y.isLanguageChangingTo&&!r(y.isLanguageChangingTo,s))return!1}}):he(s,e,n)},z=s=>typeof s=="string",ye=s=>typeof s=="object"&&s!==null,Ne=u.createContext();class be{constructor(){J(this,"getUsedNamespaces",()=>Object.keys(this.usedNamespaces));this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}}const je=(s,e)=>{const n=u.useRef();return u.useEffect(()=>{n.current=s},[s,e]),n.current},K=(s,e,n,f)=>s.getFixedT(e,n,f),we=(s,e,n,f)=>u.useCallback(K(s,e,n,f),[s,e,n,f]),ve=function(s){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{i18n:n}=e,{i18n:f,defaultNS:y}=u.useContext(Ne)||{},r=n||f||ae();if(r&&!r.reportNamespaces&&(r.reportNamespaces=new be),!r){q("You will need to pass in an i18next instance by using initReactI18next");const x=(j,b)=>z(b)?b:ye(b)&&z(b.defaultValue)?b.defaultValue:Array.isArray(j)?j[j.length-1]:j,N=[x,{},!1];return N.t=x,N.i18n={},N.ready=!1,N}r.options.react&&r.options.react.wait!==void 0&&q("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const h={...ne(),...r.options.react,...e},{useSuspense:E,keyPrefix:I}=h;let d=y||r.options&&r.options.defaultNS;d=z(d)?[d]:d||["translation"],r.reportNamespaces.addUsedNamespaces&&r.reportNamespaces.addUsedNamespaces(d);const v=(r.isInitialized||r.initializedStoreOnce)&&d.every(x=>xe(x,r,h)),P=we(r,e.lng||null,h.nsMode==="fallback"?d:d[0],I),A=()=>P,T=()=>K(r,e.lng||null,h.nsMode==="fallback"?d:d[0],I),[O,L]=u.useState(A);let B=d.join();e.lng&&(B=`${e.lng}${B}`);const $=je(B),C=u.useRef(!0);u.useEffect(()=>{const{bindI18n:x,bindI18nStore:N}=h;C.current=!0,!v&&!E&&(e.lng?X(r,e.lng,d,()=>{C.current&&L(T)}):W(r,d,()=>{C.current&&L(T)})),v&&$&&$!==B&&C.current&&L(T);const j=()=>{C.current&&L(T)};return x&&r&&r.on(x,j),N&&r&&r.store.on(N,j),()=>{C.current=!1,x&&r&&x.split(" ").forEach(b=>r.off(b,j)),N&&r&&N.split(" ").forEach(b=>r.store.off(b,j))}},[r,B]),u.useEffect(()=>{C.current&&v&&L(A)},[r,I,v]);const k=[O,r,v];if(k.t=O,k.i18n=r,k.ready=v,v||!v&&!E)return k;throw new Promise(x=>{e.lng?X(r,e.lng,d,()=>x()):W(r,d,()=>x())})},R=[{key:"top",apiTypes:["top"],label:"Верх"},{key:"bottom",apiTypes:["bottom"],label:"Низ"},{key:"footwear",apiTypes:["footwear"],label:"Обувь"},{key:"accessory",apiTypes:["accessory"],label:"Аксессуары"},{key:"fragrance",apiTypes:["fragrance"],label:"Ароматы"}],Ge=()=>{const{user:s}=re(),[e,n]=u.useState({}),[f,y]=u.useState({}),[r,h]=u.useState({}),[E,I]=u.useState(!0),[d,v]=u.useState(""),[P,A]=u.useState([]),[T,O]=u.useState(!1),[L,B]=u.useState({}),{t:$}=ve(),{favoriteIds:C}=oe(),{toast:k}=le(),x=se(),[N,j]=u.useState(""),[b,Z]=u.useState("");u.useEffect(()=>{(async()=>{try{const o={},i={},l={};if(await Promise.all(R.map(async c=>{const g=(await Promise.all(c.apiTypes.map(p=>H({category:p,limit:50})))).flat();o[c.key]=g,i[c.key]=0,l[c.key]=[]})),n(o),y(i),h(l),s)try{const c=await ie(),m={};R.forEach(g=>m[g.key]=[]),c.forEach(g=>{const p=R.find(S=>S.apiTypes.some(w=>w===(g.category||"")));p&&m[p.key].push(g)}),B(m)}catch{}}catch(o){console.error(o)}finally{I(!1)}})()},[]),u.useEffect(()=>{const t=setTimeout(()=>{(async()=>{if(d.trim().length<2){A([]);return}O(!0);try{const i=await H({q:d.trim(),limit:30});A(i)}catch(i){console.error(i)}finally{O(!1)}})()},400);return()=>clearTimeout(t)},[d]);const _=t=>{const o=R.find(i=>i.apiTypes.some(l=>l===(t.category||"")));o&&h(i=>{var m;const c=((m=i[o.key])==null?void 0:m.some(g=>g.id===t.id))??!1?i[o.key]:[...i[o.key]||[],t];return{...i,[o.key]:c}})},G=(t,o)=>{y(i=>{const l=e[t]||[];if(l.length===0)return i;const c=i[t]??0,m=o==="next"?(c+1)%l.length:(c-1+l.length)%l.length;return{...i,[t]:m}})},D=t=>{h(o=>{var p;const i=e[t]||[],l=f[t]??0,c=i[l];if(!c)return o;const g=((p=o[t])==null?void 0:p.some(S=>S.id===c.id))??!1?o[t].filter(S=>S.id!==c.id):[...o[t]||[],c];return{...o,[t]:g}})},V="/maneken.jpg";return E?a.jsx("div",{className:"flex h-64 items-center justify-center",children:$("common.loading")}):a.jsxs("div",{className:"container mx-auto flex flex-col gap-8 px-4 py-8 md:flex-row md:items-start",children:[a.jsxs("div",{className:"relative mx-auto h-[520px] w-[300px] shrink-0 shadow-lg",children:[a.jsx("img",{src:V,alt:"Mannequin",className:"absolute inset-0 h-full w-full object-contain"}),R.flatMap((t,o)=>(r[t.key]||[]).map((l,c)=>l.image_url?a.jsx(M,{src:l.image_url,alt:l.name,className:"absolute inset-0 h-full w-full object-contain",fallbackClassName:"absolute inset-0 h-full w-full",style:{zIndex:o+c+1}},`${t.key}-${l.id}`):null))]}),a.jsxs("div",{className:"flex-1 space-y-6",children:[a.jsxs("div",{className:"space-y-4 rounded-xl border p-4 shadow-sm",children:[a.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[a.jsx(U,{placeholder:"Название образа",value:N,onChange:t=>j(t.target.value)}),a.jsx(U,{placeholder:"Стиль",value:b,onChange:t=>Z(t.target.value)})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{className:"h-4 w-4 text-muted-foreground"}),a.jsx(U,{placeholder:"Поиск товара...",value:d,onChange:t=>v(t.target.value),className:"flex-1"})]}),T&&a.jsx("p",{className:"text-sm text-muted-foreground",children:"Поиск..."}),d.length>=2&&!T&&a.jsx("div",{className:"max-h-60 overflow-y-auto pt-2 grid gap-2 sm:grid-cols-2 md:grid-cols-3",children:P.length>0?P.map(t=>a.jsxs("div",{className:"flex items-center gap-2 rounded border p-2 hover:bg-accent/50",children:[a.jsx(M,{src:t.image_url,alt:t.name,className:"h-12 w-12 rounded object-cover",fallbackClassName:"h-12 w-12 rounded bg-muted"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"line-clamp-1 text-sm font-medium",title:t.name,children:t.name}),a.jsx("p",{className:"text-xs text-muted-foreground capitalize",children:t.category})]}),a.jsx(F,{size:"sm",onClick:()=>_(t),children:"Добавить"})]},t.id)):a.jsx("p",{className:"text-sm text-muted-foreground",children:"Ничего не найдено"})}),C.length>0&&a.jsxs("div",{className:"pt-4",children:[a.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[a.jsx(ue,{className:"h-4 w-4 text-yellow-500"}),a.jsx("p",{className:"text-sm font-medium",children:"Избранное"})]}),a.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(L).flatMap(([t,o])=>o.map(i=>a.jsx("button",{type:"button",onClick:()=>_(i),className:"relative h-14 w-14 overflow-hidden rounded border border-border/40 hover:ring-2 hover:ring-primary/40",children:a.jsx(M,{src:i.image_url,alt:i.name,className:"h-full w-full object-cover",fallbackClassName:"h-full w-full bg-muted"})},i.id)))})]})]}),a.jsx("div",{className:"pt-4 text-right",children:a.jsx(F,{disabled:!N.trim()||!b.trim()||Object.values(r).every(t=>t.length===0),onClick:async()=>{var t,o,i,l,c,m,g;try{const p={name:N.trim(),style:b.trim(),description:"",top_ids:((t=r.top)==null?void 0:t.map(w=>w.id))||[],bottom_ids:((o=r.bottom)==null?void 0:o.map(w=>w.id))||[],footwear_ids:((i=r.footwear)==null?void 0:i.map(w=>w.id))||[],accessories_ids:((l=r.accessory)==null?void 0:l.map(w=>w.id))||[],fragrances_ids:((c=r.fragrance)==null?void 0:c.map(w=>w.id))||[]},S=await ce(p);k({title:"Образ создан",description:S.name}),x(`/outfits/${S.id}`)}catch(p){k({variant:"destructive",title:"Ошибка",description:((g=(m=p==null?void 0:p.response)==null?void 0:m.data)==null?void 0:g.detail)||"Не удалось создать образ"})}},children:"Сохранить образ"})}),R.map(t=>{const o=e[t.key]||[],i=f[t.key],l=o[i],c=r[t.key]||[];return a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx(F,{variant:"ghost",size:"icon",onClick:()=>G(t.key,"prev"),disabled:o.length===0,className:"hover:bg-accent/50",children:a.jsx(me,{className:"h-5 w-5"})}),a.jsxs("div",{className:"flex flex-1 items-center gap-4 overflow-hidden",children:[a.jsx("span",{className:"w-28 shrink-0 text-sm font-medium",children:t.label}),l?a.jsxs("div",{className:"flex items-center gap-2 overflow-hidden",children:[a.jsx(M,{src:l.image_url,alt:l.name,className:"h-20 w-20 rounded object-cover",fallbackClassName:"h-20 w-20 rounded bg-muted"}),a.jsx("span",{className:"truncate text-sm",children:l.name})]}):a.jsx("span",{className:"text-sm text-muted-foreground",children:$("outfitBuilder.noOptions")})]}),a.jsx(F,{variant:"ghost",size:"icon",onClick:()=>G(t.key,"next"),disabled:o.length===0,className:"hover:bg-accent/50",children:a.jsx(fe,{className:"h-5 w-5"})}),a.jsx(F,{variant:"secondary",size:"sm",disabled:!l,onClick:()=>D(t.key),children:l&&c.some(m=>m.id===l.id)?"Убрать":"Добавить"}),c.length>0&&a.jsx("div",{className:"flex gap-1 overflow-x-auto",children:c.map(m=>a.jsxs("div",{className:"relative h-12 w-12 shrink-0 rounded",children:[a.jsx(M,{src:m.image_url,alt:m.name,className:"h-full w-full rounded object-cover",fallbackClassName:"h-full w-full rounded bg-muted"}),a.jsx("button",{type:"button",onClick:()=>h(g=>({...g,[t.key]:g[t.key].filter(p=>p.id!==m.id)})),className:"absolute -right-1 -top-1 rounded-full bg-red-500 p-0.5 text-white hover:bg-red-600",children:a.jsx(ge,{className:"h-3 w-3"})})]},m.id))})]},t.key)})]})]})};export{R as categoryConfig,Ge as default};
