import{j as e}from"./ui-DmaJfU4R.js";import{g as ae,r as l,L as k}from"./router-YsGj19cs.js";import{u as te,b as ie,a as re,W as ne,d as le,e as oe,f as M,c as q,g as de}from"./index-dk87i_EB.js";import{B as o}from"./button-CEL2MslA.js";import{M as A,R as B}from"./RatingStars-BNNIPRxT.js";import{C as S,d as $,a as me}from"./card-hWJdfOrY.js";import{B as E}from"./badge-CMy5sMNA.js";import{S as d}from"./skeleton-rVL-utXS.js";import{T as ce}from"./textarea-x4CJyvYj.js";import{I as xe}from"./ImageCarousel-CuJkajh5.js";import{I as ue}from"./ItemImage-C9AFigSL.js";import{C as F}from"./constants-BN7_l00R.js";import{s as he}from"./shops-CMY5BXM_.js";import{m as n}from"./proxy-OF6tZF67.js";import{S as H}from"./shopping-bag-Din1qLo_.js";import{C as K}from"./chevron-left-DxwJ_0o2.js";import{S as pe}from"./store-CkQQwr-5.js";import{P as ge}from"./package-Mme0kKEa.js";import{M as fe}from"./minus-s3m42Kqg.js";import{P as je}from"./plus-D0op2cnd.js";import{H as O}from"./heart-DyjZq6UA.js";import{T as Ne}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./createLucideIcon-BcwDLXBm.js";import"./star-Cx7l4Pfa.js";const Qe=()=>{const{id:r,moderatorId:u}=ae(),{user:p,isAdmin:W}=te(),[a,G]=l.useState(null),[m,Q]=l.useState(null),[z,U]=l.useState([]),[Y,I]=l.useState(!0),[g,f]=l.useState([]),[j,_]=l.useState(""),[R,T]=l.useState(),{isFavorite:y,toggleFavorite:Z}=ie(),{addItem:J}=re(),[t,X]=l.useState(null),[N,w]=l.useState(1);l.useEffect(()=>{(async()=>{try{if(!r||!u)return;I(!0);const[i,c,x]=await Promise.all([q.get(`/api/items/${r}`),q.get(`/api/items/${r}/similar`),he.getShop(parseInt(u))]);G(i.data),U(c.data),Q(x);const b=await M(Number(r));f(b)}catch(i){console.error(i)}finally{I(!1)}})()},[r,u]);const V=async()=>{r&&await Z(Number(r))},ee=async()=>{if(!(!r||!j.trim()))try{const s=await de(Number(r),{content:j,rating:R});f([s,...g]),_(""),T(void 0)}catch(s){console.error(s)}};if(Y)return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(d,{className:"h-6 w-24 rounded-full"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(d,{className:"aspect-square rounded-xl"})}),e.jsxs("div",{className:"w-full md:w-1/2 space-y-6",children:[e.jsx(d,{className:"h-9 w-3/4 rounded-lg"}),e.jsx(d,{className:"h-5 w-1/2 rounded-lg"}),e.jsx(d,{className:"h-7 w-1/4 rounded-lg"}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(d,{className:"h-4 w-full rounded-lg"}),e.jsx(d,{className:"h-4 w-4/5 rounded-lg"}),e.jsx(d,{className:"h-4 w-3/4 rounded-lg"})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(d,{className:"h-12 flex-1 rounded-lg"}),e.jsx(d,{className:"h-12 w-12 rounded-lg"})]})]})]})]});if(!a)return e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-16 text-center",children:[e.jsx(H,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-2xl font-semibold tracking-tight",children:"Товар не найден"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Возможно, товар был удален или перемещен"}),e.jsx(o,{asChild:!0,variant:"outline",className:"rounded-full",children:e.jsxs(k,{to:`/shops/${u}/items`,children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Вернуться в магазин"]})})]});const v=a.variants&&a.variants.length>0?Math.min(...a.variants.map(s=>typeof s.price=="number"?s.price:1/0)):void 0;let h;(t==null?void 0:t.price)!==void 0&&(t==null?void 0:t.price)!==null?h=t.price:v!==void 0&&v!==1/0?h=v:a.price!==void 0&&a.price!==null&&(h=a.price);let L=a?`${a.name}${m?" — "+m.name:""} — TRC`:"Товар — TRC",P=a?`${a.name}${a.brand?" от "+a.brand:""}${m?" в магазине "+m.name:""}. ${a.description||""}`:"Товар на платформе TRC.",se=a?`товар, ${a.name}, ${a.brand||""}, ${a.category||""}, ${m?m.name:""}, TRC`:"товар, TRC",D=a&&a.image_url?a.image_url:void 0,C=h;return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{children:[e.jsx("title",{children:L}),e.jsx("meta",{name:"description",content:P}),e.jsx("meta",{name:"keywords",content:se}),e.jsx("meta",{property:"og:title",content:L}),e.jsx("meta",{property:"og:description",content:P}),D&&e.jsx("meta",{property:"og:image",content:D}),C&&e.jsx("meta",{property:"product:price:amount",content:String(C)}),C&&e.jsx("meta",{property:"product:price:currency",content:"KZT"})]}),e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-8",children:[e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-6",children:e.jsx(o,{asChild:!0,variant:"ghost",className:"pl-0 hover:bg-transparent",children:e.jsxs(k,{to:`/shops/${u}/items`,className:"flex items-center text-sm text-muted-foreground hover:text-foreground",children:[e.jsx(K,{className:"mr-1 h-4 w-4"}),"Назад в магазин"]})})}),m&&e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mb-6",children:e.jsx(S,{className:"border-0 shadow-sm",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:m.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Модератор: ",m.moderator_name]})]})]})})})}),e.jsxs("div",{className:"mb-16 flex flex-col md:flex-row gap-8 md:gap-12",children:[e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:a.image_urls&&a.image_urls.length>0?e.jsx(xe,{images:a.image_urls,className:"rounded-xl shadow-sm",aspectClassName:"aspect-square"}):e.jsx("div",{className:"aspect-square overflow-hidden rounded-xl bg-muted shadow-sm",children:e.jsx(ue,{src:a.image_url,alt:a.name,className:"h-full w-full object-cover transition-transform duration-500 hover:scale-105",fallbackClassName:"flex aspect-square items-center justify-center rounded-xl bg-muted shadow-sm"})})}),e.jsxs(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:a.category&&e.jsx(E,{variant:"outline",className:"text-xs capitalize",children:F[a.category]??a.category})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold tracking-tight",children:a.name}),a.brand&&e.jsx("p",{className:"mb-4 text-lg text-muted-foreground",children:a.brand}),h!==void 0&&e.jsxs("p",{className:"mb-6 text-2xl font-bold",children:[h.toLocaleString(),"₸"]}),(a.color||a.size||a.style||a.collection)&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[a.color&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Цвет"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.color})]}),a.size&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Размер"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.size})]}),a.style&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Стиль"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.style})]}),a.collection&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Коллекция"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.collection})]})]}),a.variants&&a.variants.length>0&&e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Выберите вариант"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:a.variants.map(s=>{const i=[];s.size&&i.push(s.size),s.color&&i.push(s.color);const c=i.join(" ")||s.sku||String(s.id),x=(t==null?void 0:t.id)===s.id,b=s.stock!==void 0&&s.stock===0;return e.jsxs(o,{type:"button",variant:x?"default":"outline",size:"default",disabled:b,className:`flex flex-col items-start justify-between gap-1 rounded-xl border-2 px-3 py-3 transition-all duration-200 min-h-[84px] ${x?"border-primary shadow-sm":"border-transparent hover:border-muted-foreground/40"} ${b?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{X(s),w(1)},children:[e.jsx("span",{className:"font-medium leading-tight",children:c}),s.price!==void 0&&s.price!==null&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.price.toLocaleString(),"₸"]}),s.stock!==void 0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.stock>0?`${s.stock} шт.`:"Нет в наличии"})]},s.id)})}),t&&e.jsxs("div",{className:"flex items-center gap-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Доступно: ",t.stock??"—"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-muted rounded-lg p-1",children:[e.jsx(o,{variant:"ghost",size:"sm",disabled:N<=1,onClick:()=>w(s=>Math.max(1,s-1)),className:"h-8 w-8 rounded-md",children:e.jsx(fe,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center font-medium",children:N}),e.jsx(o,{variant:"ghost",size:"sm",disabled:t.stock!==void 0&&N>=t.stock,onClick:()=>w(s=>t.stock!==void 0?Math.min(t.stock,s+1):s+1),className:"h-8 w-8 rounded-md",children:e.jsx(je,{className:"h-3 w-3"})})]})]})]}),a.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-2 font-medium",children:"Описание"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:a.description})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{size:"lg",className:"flex-1 rounded-lg shadow-sm hover:shadow-md transition-shadow",disabled:!t,onClick:()=>{!a||!t||J({id:t.id,item_id:a.id,name:a.name,price:t.price??a.price??0,image_url:a.image_url,size:t.size,color:t.color,quantity:N,stock:t.stock})},children:"Добавить в корзину"}),e.jsx(o,{size:"lg",variant:y(Number(r))?"default":"outline",className:"rounded-lg px-3 shadow-sm hover:shadow-md transition-shadow",onClick:V,children:e.jsx(O,{className:`h-5 w-5 ${y(Number(r))?"fill-current":""}`,strokeWidth:y(Number(r))?2:1.5})})]})]})]}),z.length>0&&e.jsxs(n.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},className:"mb-16",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold tracking-tight",children:"Похожие товары"}),e.jsx(n.div,{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:z.map(s=>e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(S,{className:"group overflow-hidden transition-all hover:shadow-lg border-0 shadow-sm",children:e.jsxs(k,{to:`/shops/${u}/items/${s.id}`,className:"block",children:[e.jsx("div",{className:"relative aspect-[3/4] overflow-hidden",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted",children:e.jsx(H,{className:"h-12 w-12 text-muted-foreground"})})}),e.jsxs($,{className:"p-4",children:[e.jsxs("div",{className:"mb-2",children:[s.category&&e.jsx(E,{variant:"outline",className:"mb-2 text-xs capitalize",children:F[s.category]??s.category}),e.jsx("h3",{className:"font-medium leading-tight line-clamp-1",title:s.name,children:s.name}),s.brand&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.brand})]}),(()=>{let i;if(s.variants&&s.variants.length>0){const c=s.variants.map(x=>x.price).filter(x=>typeof x=="number");c.length>0&&(i=Math.min(...c))}return i===void 0&&(i=s.price??void 0),i!==void 0?e.jsxs("p",{className:"font-semibold",children:[i.toLocaleString()," ₸"]}):null})()]})]})})},s.id))})]}),e.jsxs(n.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.3},className:"mb-16",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Отзывы"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(A,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:g.length})]})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"mb-8 rounded-xl border p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-medium",children:"Оставить отзыв"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Ваша оценка"}),e.jsx(B,{value:R,onChange:T})]}),e.jsx(ce,{placeholder:"Расскажите о вашем опыте использования этого товара...",value:j,onChange:s=>_(s.target.value),rows:4,className:"rounded-lg border-muted"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(o,{onClick:ee,disabled:!j.trim(),className:"rounded-lg",children:"Отправить отзыв"})})]})]}),g.length===0?e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"rounded-xl border p-8 text-center shadow-sm",children:[e.jsx(A,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-lg font-medium",children:"Пока нет отзывов"}),e.jsx("p",{className:"text-muted-foreground",children:"Будьте первым, кто оставит отзыв об этом товаре"})]}):e.jsx(n.ul,{className:"space-y-4",children:g.map(s=>e.jsx(n.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(S,{className:"overflow-hidden border-0 shadow-sm",children:[e.jsx(me,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.user_name??"Пользователь"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]}),((p==null?void 0:p.id)===s.user_id||W)&&e.jsx(o,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 h-8 w-8 rounded-full",onClick:async()=>{if(r&&confirm("Удалить комментарий?"))try{await le(Number(r),s.id),f(i=>i.filter(c=>c.id!==s.id))}catch(i){console.error(i)}},children:e.jsx(Ne,{className:"h-4 w-4"})})]})}),e.jsxs($,{className:"pt-0",children:[s.rating!==void 0&&s.rating!==null&&e.jsx("div",{className:"mb-3",children:e.jsx(B,{value:s.rating})}),e.jsx("p",{className:"mb-4 whitespace-pre-line text-muted-foreground",children:s.content}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(o,{variant:"ghost",size:"sm",className:"flex items-center gap-2 rounded-full",onClick:async()=>{if(!(!r||!p))try{await oe(Number(r),s.id);const i=await M(Number(r));f(i)}catch(i){console.error(i)}},children:[e.jsx(O,{className:`h-4 w-4 ${s.likes>0?"fill-primary text-primary":""}`}),e.jsx("span",{children:s.likes})]})})]})]})},s.id))})]})]})]})};export{Qe as default};
