import{j as e}from"./ui-DmaJfU4R.js";import{r as a,u as ie,L as ne}from"./router-YsGj19cs.js";import{b as le,W as ce,l as oe}from"./index-dk87i_EB.js";import{C as _,d as V}from"./card-hWJdfOrY.js";import{I as F}from"./input-DSjIL0vM.js";import{B as S}from"./button-CEL2MslA.js";import{B as z}from"./badge-CMy5sMNA.js";import{I as de}from"./ImageCarousel-CuJkajh5.js";import{I as me}from"./ItemImage-C9AFigSL.js";import{C as x}from"./constants-BN7_l00R.js";import{S as ue,a as he,b as pe,c as xe,d as A}from"./select-DS8I4ch4.js";import{S as fe}from"./switch-DVYTxNX9.js";import{P as ge,a as je,b as ve}from"./popover-S1_DSqif.js";import{L as M}from"./label-BnZhCuKw.js";import{m as v}from"./proxy-OF6tZF67.js";import{S as H}from"./search-DxfJQDsN.js";import{F as Ne}from"./filter-Cda4LJKM.js";import{H as ye}from"./heart-DyjZq6UA.js";import{S as be}from"./shopping-bag-Din1qLo_.js";import"./vendor-BtP0CW_r.js";import"./utils-CytzSlOG.js";import"./index-BwobEAja.js";import"./createLucideIcon-BcwDLXBm.js";import"./check-Jm2HgjeV.js";const Ye=()=>{const[f,P]=a.useState([]),[o,E]=a.useState(!0),[N,O]=a.useState(!1),[i,B]=a.useState(""),[c,I]=a.useState(1),[y,$]=a.useState(!0),{isFavorite:G,toggleFavorite:K}=le(),[n,U]=a.useState(void 0),[h,W]=a.useState(!1),[Y,J]=a.useState(!1),[d,Q]=a.useState(""),[m,X]=a.useState(""),Z=ie(),b=new URLSearchParams(Z.search).get("brand");let g="Каталог товаров — TRC",p="Каталог модной одежды, аксессуаров и обуви на платформе TRC. Большой выбор, фильтры, тренды.",C="каталог, одежда, обувь, аксессуары, мода, покупки, TRC";n&&x[n]&&(g=`${x[n]} — Каталог — TRC`,p=`Каталог: ${x[n]}. Модная одежда и аксессуары на TRC.`,C+=`, ${x[n]}`),b&&(g=`Бренд: ${b} — Каталог — TRC`,p=`Каталог товаров бренда «${b}» на TRC.`,C+=`, бренд, ${b}`),i&&(g=`Поиск: ${i} — Каталог — TRC`,p=`Результаты поиска по запросу «${i}» в каталоге TRC.`,C+=`, поиск, ${i}`),(d||m)&&(p+=` Цена: ${d||"от"} — ${m||"до"}.`);const D=async(s,t,r,l)=>{const u={page:s};t!=null&&t!==""&&(u.q=t),r&&r!=="all"&&(u.category=r);let j=await oe(u);return l&&(j=j.filter(T=>L(T).hasDiscount)),(d||m)&&(j=j.filter(T=>{const k=R(T);if(k===void 0)return!1;const ae=d?parseFloat(d):0,re=m?parseFloat(m):1/0;return k>=ae&&k<=re})),j};a.useEffect(()=>{E(!0),P([]),$(!0),I(1),D(1,i,n,h).then(s=>{P(s),$(s.length===20),E(!1)})},[i,n,h,d,m]),a.useEffect(()=>{c!==1&&(O(!0),D(c,i,n,h).then(s=>{P(t=>[...t,...s]),$(s.length===20),O(!1)}))},[c]);const q=s=>{s.preventDefault(),B(i)},w=a.useRef(null),ee=a.useCallback(s=>{o||y&&(w.current&&w.current.disconnect(),w.current=new IntersectionObserver(t=>{t[0].isIntersecting&&I(r=>r+1)}),s&&w.current.observe(s))},[o,y]);a.useEffect(()=>{c!==1&&D(c,i,n,h)},[c,i,n,h]);const se={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},te={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},R=s=>{if(s.variants&&s.variants.length>0){const t=s.variants.map(r=>r.price).filter(r=>typeof r=="number"&&r!==null);if(t.length>0)return Math.min(...t)}return s.price??void 0},L=s=>{if(!s.price||typeof s.price!="number")return{hasDiscount:!1};const t=R(s);if(!t||t>=s.price)return{hasDiscount:!1};const r=Math.round((s.price-t)/s.price*100);return{hasDiscount:!0,originalPrice:s.price,discountPercent:r}};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{children:[e.jsx("title",{children:g}),e.jsx("meta",{name:"description",content:p}),e.jsx("meta",{name:"keywords",content:C}),e.jsx("meta",{property:"og:title",content:g}),e.jsx("meta",{property:"og:description",content:p})]}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-8",children:[e.jsx("h1",{className:"mb-4 font-display text-3xl font-bold tracking-tight",children:"Товары"}),e.jsx("p",{className:"text-muted-foreground",children:"Найдите идеальные вещи для вашего гардероба."})]}),e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("form",{onSubmit:q,className:"flex w-full max-w-md items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(H,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(F,{placeholder:"Поиск товаров...",value:i,onChange:s=>B(s.target.value),className:"pl-10"})]}),e.jsx(S,{type:"submit",size:"icon",children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsxs(ge,{open:Y,onOpenChange:J,children:[e.jsx(je,{asChild:!0,children:e.jsxs(S,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Фильтры"]})}),e.jsx(ve,{className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(M,{className:"mb-1 block",children:"Категория"}),e.jsxs(ue,{value:n||"",onValueChange:s=>U(s===""?void 0:s),children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Все категории"})}),e.jsxs(xe,{children:[e.jsx(A,{value:"all",children:"Все категории"}),Object.entries(x).map(([s,t])=>e.jsx(A,{value:s,children:t},s))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(M,{htmlFor:"discount-switch",children:"Только со скидкой"}),e.jsx(fe,{id:"discount-switch",checked:h,onCheckedChange:W})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{className:"block",children:"Цена"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(F,{placeholder:"От",value:d,onChange:s=>Q(s.target.value),type:"number",min:"0"})}),e.jsx("div",{className:"flex-1",children:e.jsx(F,{placeholder:"До",value:m,onChange:s=>X(s.target.value),type:"number",min:"0"})})]})]})]})})]})]}),o&&e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:Array.from({length:8}).map((s,t)=>e.jsxs(_,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-[3/4] animate-pulse bg-muted"}),e.jsx(V,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-2/3 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-4 w-1/3 animate-pulse rounded bg-muted"})]})})]},t))}),!o&&f.length>0&&e.jsx(v.div,{variants:se,initial:"hidden",animate:"visible",className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:f.map((s,t)=>{const r=t===f.length-1?{ref:ee}:{};return e.jsx(v.div,{variants:te,...r,children:e.jsx(_,{className:"group overflow-hidden transition-all hover:shadow-lg",children:e.jsxs(ne,{to:`/items/${s.id}`,children:[e.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden",children:[s.image_urls&&s.image_urls.length>0?e.jsx(de,{images:s.image_urls,className:"transition-transform duration-500 group-hover:scale-105"}):e.jsx(me,{src:s.image_url,alt:s.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105",fallbackClassName:"h-full w-full"}),(()=>{const l=L(s);return l.hasDiscount?e.jsx("div",{className:"absolute top-3 left-3",children:e.jsxs(z,{className:"bg-red-500 text-white text-xs font-bold",children:["-",l.discountPercent,"%"]})}):null})(),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(S,{size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full",onClick:async l=>{l.preventDefault(),await K(s.id)},children:e.jsx(ye,{className:`h-4 w-4 ${G(s.id)?"fill-primary text-primary":""}`})})})]}),e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"mb-2",children:[s.category&&e.jsx(z,{variant:"outline",className:"mb-2 text-xs capitalize",children:x[s.category]??s.category}),e.jsx("h3",{className:"font-medium leading-tight",title:s.name,children:s.name}),s.brand&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.brand})]}),(()=>{const l=R(s),u=L(s);return l===void 0?null:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"font-semibold",children:[l.toLocaleString()," ₸"]}),u.hasDiscount&&u.originalPrice&&e.jsxs("p",{className:"text-sm text-muted-foreground line-through",children:[u.originalPrice.toLocaleString()," ₸"]})]})})()]})]})})},s.id)})}),N&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Загрузка..."})]})}),!o&&y&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(S,{onClick:()=>I(s=>s+1),disabled:N,variant:"outline",children:N?"Загрузка...":`Загрузить ещё (${c} → ${c+1})`})}),!o&&!N&&!y&&f.length>0&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Больше товаров нет"})}),!o&&f.length===0&&e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"py-16 text-center",children:[e.jsx(be,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 font-display text-xl font-semibold",children:"Товары не найдены"}),e.jsx("p",{className:"text-muted-foreground",children:"Попробуйте изменить параметры поиска или вернитесь позже"})]})]})]})};export{Ye as default};
