import{j as e}from"./ui-DmaJfU4R.js";import{r as s,L}from"./router-YsGj19cs.js";import{c as I}from"./index-dk87i_EB.js";import{B as l}from"./button-CEL2MslA.js";import{u as H}from"./use-toast-BimaNeed.js";import{S as Y,a as q,b as J,c as K,d as E}from"./select-DS8I4ch4.js";import{S as U}from"./switch-DVYTxNX9.js";import{P as X,a as Z,b as ee}from"./popover-S1_DSqif.js";import{L as g}from"./label-BnZhCuKw.js";import{C as M}from"./constants-BN7_l00R.js";import{L as O}from"./loader-circle-yzSCNo-f.js";import{m as T}from"./proxy-OF6tZF67.js";import{C as te}from"./circle-plus-C0p9U_YC.js";import{P as se}from"./pencil-sRn5a90G.js";import{T as ae}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./createLucideIcon-BcwDLXBm.js";import"./check-Jm2HgjeV.js";const Se=()=>{const[y,m]=s.useState([]),[j,N]=s.useState(!0),[v,b]=s.useState(!1),[x,a]=s.useState(1),[D,w]=s.useState(!0),[S,F]=s.useState(""),[p,_]=s.useState(""),[k,C]=s.useState(null),{toast:h}=H(),[c,A]=s.useState(void 0),[n,B]=s.useState(""),[d,$]=s.useState(""),[u,z]=s.useState(!1),[Q,R]=s.useState(!1),P=async(t=1,r=!1,o)=>{try{r?b(!0):N(!0);const i={page:t};o&&(i.q=o),c&&(i.category=c),u&&(i.min_price=0),n&&(i.min_price=parseFloat(n)),d&&(i.max_price=parseFloat(d));const f=await I.get("/api/items/",{params:i});m(G=>r?[...G,...f.data]:f.data),w(f.data.length===20)}catch{h({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить список вещей"})}finally{N(!1),b(!1)}};s.useEffect(()=>{a(1),P(1,!1,p)},[p,c,n,d,u]),s.useEffect(()=>{x!==1&&P(x,!0,p)},[x]);const V=t=>{t.preventDefault(),a(1),m([]),w(!0),_(S)},W=async t=>{if(confirm("Вы уверены, что хотите удалить эту вещь?")){C(t);try{await I.delete(`/api/items/${t}`),m(r=>r.filter(o=>o.id!==t)),h({title:"Успешно",description:"Вещь успешно удалена",className:"border-0 bg-green-500 text-white shadow-lg"})}catch{h({variant:"destructive",title:"Ошибка",description:"Не удалось удалить вещь"})}finally{C(null)}}};return j?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(O,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(T.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Управление вещами"}),e.jsxs("form",{onSubmit:V,className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Поиск по названию...",value:S,onChange:t=>F(t.target.value),className:"border rounded px-2 py-1"}),e.jsx(l,{type:"submit",children:"Поиск"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{open:Q,onOpenChange:R,children:[e.jsx(Z,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Фильтры"})}),e.jsx(ee,{className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[M&&e.jsxs("div",{children:[e.jsx(g,{className:"mb-1 block",children:"Категория"}),e.jsxs(Y,{value:c||"all",onValueChange:t=>{A(t==="all"?void 0:t),a(1)},children:[e.jsx(q,{children:e.jsx(J,{placeholder:"Все категории"})}),e.jsxs(K,{children:[e.jsx(E,{value:"all",children:"Все категории"}),Object.entries(M).map(([t,r])=>e.jsx(E,{value:t,children:r},t))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(g,{htmlFor:"only-price-switch",children:"Только с ценой"}),e.jsx(U,{id:"only-price-switch",checked:u,onCheckedChange:t=>{z(t),a(1)}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"block",children:"Цена"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{placeholder:"От",value:n,onChange:t=>{B(t.target.value),a(1)},type:"number",min:"0",className:"border rounded px-2 py-1 w-full"})}),e.jsx("div",{className:"flex-1",children:e.jsx("input",{placeholder:"До",value:d,onChange:t=>{$(t.target.value),a(1)},type:"number",min:"0",className:"border rounded px-2 py-1 w-full"})})]})]})]})})]}),e.jsx(l,{asChild:!0,children:e.jsxs(L,{to:"/admin/items/new",className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Добавить вещь"]})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-sm dark:border-gray-800 dark:bg-gray-950",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Название"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Цена"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-medium text-gray-700 dark:text-gray-300",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:y.length>0?y.map(t=>e.jsxs(T.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50/50 dark:hover:bg-gray-900/50",children:[e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100",children:t.id}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100",children:t.name}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:t.price?`${t.price} ₽`:"-"}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",asChild:!0,className:"border-gray-300 dark:border-gray-700",children:e.jsxs(L,{to:`/admin/items/${t.id}/edit`,className:"flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"}),e.jsx("span",{children:"Редактировать"})]})}),e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>W(t.id),disabled:k===t.id,className:"flex items-center gap-1",children:[k===t.id?e.jsx(O,{className:"h-3 w-3 animate-spin"}):e.jsx(ae,{className:"h-3 w-3"}),e.jsx("span",{children:"Удалить"})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет доступных вещей"})})})]})}),!j&&D&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(l,{onClick:()=>a(t=>t+1),disabled:v,children:v?"Загрузка...":"Загрузить ещё"})})]})};export{Se as default};
