import{j as e}from"./ui-DmaJfU4R.js";import{r,L as w}from"./router-YsGj19cs.js";import{W as B,v as L,t as P}from"./index-8jId_CL5.js";import{v as T,h as _}from"./outfits-5_GSKzeO.js";import{C as M,d as V}from"./card-hWJdfOrY.js";import{B as F}from"./button-CEL2MslA.js";import{B as z}from"./badge-CMy5sMNA.js";import{C as A}from"./constants-BN7_l00R.js";import{C as $}from"./clock-B5XmQ9i6.js";import{m as C}from"./proxy-OF6tZF67.js";import{S as D}from"./shopping-bag-Din1qLo_.js";import"./vendor-BtP0CW_r.js";import"./utils-CytzSlOG.js";import"./index-BwobEAja.js";import"./createLucideIcon-BcwDLXBm.js";const ie=()=>{const[n,u]=r.useState([]),[c,h]=r.useState([]),[i,O]=r.useState(!0),[m,x]=r.useState(1),[d,g]=r.useState(1),[p,j]=r.useState(!0),[v,y]=r.useState(!0),b=async(t,a=!1)=>{try{const s=await L(t);u(f=>a?[...f,...s]:s),j(s.length===20)}catch(s){console.error(s)}},N=async(t,a=!1)=>{try{const s=await T(t);h(f=>a?[...f,...s]:s),y(s.length===20)}catch(s){console.error(s)}},R=async()=>{try{await Promise.all([b(1),N(1)])}catch(t){console.error(t)}finally{O(!1)}};r.useEffect(()=>{R()},[]);const S=async()=>{try{await Promise.all([P(),_()]),u([]),h([]),x(1),g(1),j(!0),y(!0)}catch(t){console.error(t)}},o=r.useRef(null),I=r.useCallback(t=>{i||p&&(o.current&&o.current.disconnect(),o.current=new IntersectionObserver(a=>{a[0].isIntersecting&&x(s=>s+1)}),t&&o.current.observe(t))},[i,p]),l=r.useRef(null),k=r.useCallback(t=>{i||v&&(l.current&&l.current.disconnect(),l.current=new IntersectionObserver(a=>{a[0].isIntersecting&&g(s=>s+1)}),t&&l.current.observe(t))},[i,v]);r.useEffect(()=>{m>1&&b(m,!0)},[m]),r.useEffect(()=>{d>1&&N(d,!0)},[d]);const E={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},H={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return e.jsxs(e.Fragment,{children:[e.jsxs(B,{children:[e.jsx("title",{children:"История просмотров — TRC"}),e.jsx("meta",{name:"description",content:"История ваших просмотров товаров и образов на платформе TRC."}),e.jsx("meta",{name:"keywords",content:"история, просмотры, товары, образы, TRC"}),e.jsx("meta",{property:"og:title",content:"История просмотров — TRC"}),e.jsx("meta",{property:"og:description",content:"История ваших просмотров товаров и образов на платформе TRC."})]}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h1",{className:"font-display text-3xl font-bold tracking-tight",children:"История просмотров"}),(n.length>0||c.length>0)&&e.jsx(F,{variant:"outline",size:"sm",onClick:S,children:"Очистить историю"})]}),i&&e.jsx("p",{className:"py-8 text-center",children:"Загрузка..."}),!i&&n.length===0&&c.length===0&&e.jsxs("div",{className:"flex flex-col items-center py-16 text-muted-foreground",children:[e.jsx($,{className:"mb-4 h-12 w-12 text-muted-foreground"}),e.jsx("p",{children:"История просмотров пуста"})]}),!i&&n.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"Товары"}),e.jsx(C.div,{variants:E,initial:"hidden",animate:"visible",className:"mb-10 grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:n.map((t,a)=>e.jsx(C.div,{variants:H,ref:a===n.length-1?I:null,children:e.jsx(M,{className:"group overflow-hidden transition-all hover:shadow-lg",children:e.jsxs(w,{to:`/items/${t.id}`,children:[e.jsx("div",{className:"relative aspect-[3/4] overflow-hidden",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted",children:e.jsx(D,{className:"h-10 w-10 text-muted-foreground"})})}),e.jsxs(V,{className:"p-4",children:[e.jsxs("div",{className:"mb-2",children:[t.category&&e.jsx(z,{variant:"outline",className:"mb-2 text-xs capitalize",children:A[t.category]??t.category}),e.jsx("h3",{className:"font-medium leading-tight",title:t.name,children:t.name}),t.brand&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.brand})]}),t.price!==null&&t.price!==void 0&&e.jsxs("p",{className:"font-semibold",children:[t.price.toLocaleString()," ₸"]})]})]})})},t.id))})]}),!i&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold",children:"Образы"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:c.map((t,a)=>e.jsxs(w,{to:`/outfits/${t.id}`,className:"block rounded-md border p-4 hover:shadow",ref:a===c.length-1?k:null,children:[e.jsx("h3",{className:"text-lg font-medium",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Стиль: ",t.style]}),t.total_price&&e.jsxs("p",{className:"mt-2 font-semibold",children:[t.total_price,"₸"]})]},t.id))})]})]})]})};export{ie as default};
