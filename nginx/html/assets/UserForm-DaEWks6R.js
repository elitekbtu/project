import{j as e}from"./ui-DmaJfU4R.js";import{f as _,g as C,r as l}from"./router-YsGj19cs.js";import{c as f}from"./index-Czdh4XVO.js";import{B as p}from"./button-CEL2MslA.js";import{I as y}from"./input-DSjIL0vM.js";import{L as c}from"./label-BnZhCuKw.js";import{S as u}from"./switch-DVYTxNX9.js";import{u as S}from"./use-toast-BimaNeed.js";import{c as F}from"./utils-CytzSlOG.js";import{L as v}from"./loader-circle-yzSCNo-f.js";import{m as U}from"./proxy-OF6tZF67.js";import{A as L}from"./arrow-left-CZ8lUGg0.js";import{S as E}from"./save-CC2lNIMm.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./createLucideIcon-BcwDLXBm.js";const R=async r=>(await f.post("/api/users/",r)).data,$=async r=>(await f.get(`/api/users/${r}`)).data,q=async(r,t)=>(await f.patch(`/api/users/${r}`,t)).data,A={email:"",password:"",is_admin:!1,is_moderator:!1,is_active:!0},Y=()=>{const r=_(),{id:t}=C(),{toast:i}=S(),o=!!t,[a,g]=l.useState(A),[j,N]=l.useState(!0),[m,b]=l.useState(!1);l.useEffect(()=>{(async()=>{try{if(o){const s=await $(Number(t));g({email:s.email,password:"",is_admin:!!s.is_admin,is_moderator:!!s.is_moderator,is_active:!!s.is_active})}}catch{i({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить данные пользователя"})}finally{N(!1)}})()},[t,o,i]);const h=d=>{const{name:s,value:n}=d.target;g(w=>({...w,[s]:n}))},x=d=>{g(s=>({...s,[d]:!s[d]}))},k=async d=>{if(d.preventDefault(),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){i({variant:"destructive",title:"Ошибка",description:"Некорректный email"});return}if(!o&&a.password.length<8){i({variant:"destructive",title:"Ошибка",description:"Пароль должен содержать минимум 8 символов"});return}b(!0);try{if(o){const n={email:a.email,password:a.password||void 0,is_admin:a.is_admin,is_moderator:a.is_moderator,is_active:a.is_active};await q(Number(t),n),i({title:"Успешно",description:"Пользователь успешно обновлен",className:"border-0 bg-green-500 text-white shadow-lg"})}else await R(a),i({title:"Успешно",description:"Пользователь успешно создан",className:"border-0 bg-green-500 text-white shadow-lg"});r("/admin/users")}catch{i({variant:"destructive",title:"Ошибка",description:"Произошла ошибка при сохранении",className:"shadow-lg"})}finally{b(!1)}};return j?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"container mx-auto max-w-2xl px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>r("/admin/users"),className:"shrink-0 hover:bg-accent/50",children:e.jsx(L,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:o?"Редактирование пользователя":"Создание нового пользователя"})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-800 dark:bg-gray-950",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-gray-900 dark:text-gray-50",children:"Основная информация"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{htmlFor:"email",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email*"}),e.jsx(y,{id:"email",name:"email",type:"email",value:a.email,onChange:h,required:!0,placeholder:"user@example.com",className:"focus:border-primary focus:ring-2 focus:ring-primary/20"})]}),o?e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{htmlFor:"password",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Новый пароль"}),e.jsx(y,{id:"password",name:"password",type:"password",value:a.password,onChange:h,placeholder:"Оставьте пустым, чтобы не менять",className:"focus:border-primary focus:ring-2 focus:ring-primary/20"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{htmlFor:"password",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Пароль*"}),e.jsx(y,{id:"password",name:"password",type:"password",value:a.password,onChange:h,required:!0,placeholder:"••••••••",className:"focus:border-primary focus:ring-2 focus:ring-primary/20"})]})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-6 shadow-sm dark:border-gray-800 dark:bg-gray-950",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-gray-900 dark:text-gray-50",children:"Настройки"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"is_admin",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Администратор"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Дает полный доступ к панели управления"})]}),e.jsx(u,{id:"is_admin",checked:a.is_admin,onCheckedChange:()=>x("is_admin"),className:"data-[state=checked]:bg-primary data-[state=unchecked]:bg-gray-200 dark:data-[state=unchecked]:bg-gray-700"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"is_moderator",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Модератор"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Может создавать товары и управлять своими товарами"})]}),e.jsx(u,{id:"is_moderator",checked:!!a.is_moderator,onCheckedChange:()=>x("is_moderator"),className:"data-[state=checked]:bg-yellow-500 data-[state=unchecked]:bg-gray-200 dark:data-[state=unchecked]:bg-gray-700"})]}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-900/50",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"is_active",className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Активный"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Позволяет пользователю входить в систему"})]}),e.jsx(u,{id:"is_active",checked:a.is_active,onCheckedChange:()=>x("is_active"),className:"data-[state=checked]:bg-green-500 data-[state=unchecked]:bg-gray-200 dark:data-[state=unchecked]:bg-gray-700"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>r("/admin/users"),className:"border-gray-300 text-gray-700 hover:bg-gray-50 dark:border-gray-700 dark:text-gray-300 dark:hover:bg-gray-800",children:"Отмена"}),e.jsxs(p,{type:"submit",disabled:m,className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary shadow-lg",children:[m&&e.jsx(v,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(E,{className:F("h-4 w-4",!m&&"mr-2")}),m?"Сохранение...":"Сохранить"]})]})]})]})};export{Y as default};
