import{j as e}from"./ui-DmaJfU4R.js";import{r as a,L as k}from"./router-YsGj19cs.js";import{c as A,A as M}from"./index-dk87i_EB.js";import{C as j,d as I}from"./card-hWJdfOrY.js";import{I as z}from"./input-DSjIL0vM.js";import{B as x}from"./button-CEL2MslA.js";import{A as p,b as v}from"./avatar-CBOADE_9.js";import{c as N}from"./createLucideIcon-BcwDLXBm.js";import{X as E}from"./x-DBAcYj4I.js";import{S as _}from"./shopping-bag-Din1qLo_.js";import{U as L}from"./user-BuBPZYTe.js";import"./vendor-BtP0CW_r.js";import"./utils-CytzSlOG.js";import"./index-BwobEAja.js";/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=N("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=N("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),O=async(i,r)=>(await A.post("/api/chat-stylist/",{message:i,user_profile:r})).data,V=e.jsx(v,{className:"bg-muted text-muted-foreground",children:e.jsx(R,{className:"w-5 h-5"})}),$=e.jsx(v,{className:"bg-muted text-muted-foreground",children:e.jsx(L,{className:"w-5 h-5"})}),W=()=>{const i="chat_stylist_history",[r,c]=a.useState(()=>{try{const s=sessionStorage.getItem(i);return s?JSON.parse(s):[]}catch{return[]}}),[d,f]=a.useState(""),[w,g]=a.useState(!1),[m,b]=a.useState(!1),h=a.useRef(null),n=a.useContext(M),o=n&&typeof n=="object"&&n!==null&&"user"in n?n.user:void 0;a.useEffect(()=>{sessionStorage.setItem(i,JSON.stringify(r))},[r]),a.useEffect(()=>{m&&h.current&&h.current.scrollIntoView({behavior:"smooth"})},[r,m]);const y=async()=>{if(!d.trim())return;c([...r,{role:"user",text:d}]),g(!0);const s=await O(d,o);let l=s.reply,t="";const u=l.match(/–°–æ–≤–µ—Ç –ø–æ —Ä–∞–∑–º–µ—Ä—É:([^\n]+)/i);u&&(t=u[1].trim(),l=l.replace(u[0],"").trim()),c(C=>[...C,{role:"ai",text:l+(t?`

üëï –°–æ–≤–µ—Ç –ø–æ —Ä–∞–∑–º–µ—Ä—É: ${t}`:""),items:s.items}]),f(""),g(!1)},S=()=>{c([]),sessionStorage.removeItem(i)};return m?e.jsxs("div",{className:"fixed bottom-0 right-0 z-40 w-full max-w-md sm:max-w-sm md:max-w-md lg:max-w-lg xl:max-w-xl h-[45vh] sm:h-[55vh] md:h-[65vh] lg:h-[75vh] xl:h-[80vh] bg-white border border-slate-200 rounded-2xl shadow-xl flex flex-col animate-fade-in md:bottom-0 md:mb-0 mb-[60px] md:mb-0",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200 bg-white rounded-t-2xl",children:[e.jsx("span",{className:"text-base font-semibold text-foreground",children:"–ò–ò —á–∞—Ç-—Å—Ç–∏–ª–∏—Å—Ç"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(x,{variant:"ghost",size:"icon",onClick:S,className:"text-muted-foreground",title:"–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç",children:"üóëÔ∏è"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:()=>b(!1),className:"text-muted-foreground",children:e.jsx(E,{className:"w-5 h-5"})})]})]}),o&&e.jsxs("div",{className:"px-4 py-2 text-xs text-muted-foreground border-b bg-muted/10",children:["–í–∞—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: —Ä–æ—Å—Ç ",o.height||"-"," —Å–º, –≤–µ—Å ",o.weight||"-"," –∫–≥, –≥—Ä—É–¥—å ",o.chest||"-"," —Å–º, —Ç–∞–ª–∏—è ",o.waist||"-"," —Å–º, –±—ë–¥—Ä–∞ ",o.hips||"-"," —Å–º"]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3 bg-background",children:[r.length===0&&e.jsx("div",{className:"text-muted-foreground text-center mt-8 text-sm",children:"–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å —Å—Ç–∏–ª–∏—Å—Ç—É..."}),r.map((s,l)=>e.jsx("div",{className:`flex ${s.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:"flex items-end gap-2 max-w-[80%]",children:[s.role==="ai"&&e.jsx(p,{className:"h-8 w-8 border border-slate-200 bg-muted",children:V}),e.jsx(j,{className:`rounded-2xl border bg-white shadow-sm ${s.role==="user"?"ml-auto":""} w-full`,children:e.jsxs(I,{className:"p-3",children:[e.jsx("div",{className:"text-sm text-foreground whitespace-pre-line mb-2",children:s.text}),s.items&&s.items.length>0&&e.jsx("div",{className:"grid grid-cols-1 gap-3 mt-2",children:s.items.map(t=>e.jsx(k,{to:`/items/${t.id}`,className:"block",children:e.jsxs(j,{className:"flex flex-row items-center gap-3 border bg-muted/30 p-2 hover:bg-muted/50 transition-colors cursor-pointer",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-14 h-14 object-cover rounded-md border"}):e.jsx(p,{className:"h-8 w-8 border border-slate-200 bg-muted",children:e.jsx(_,{className:"w-5 h-5 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",title:t.name,children:t.name}),t.brand&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:t.brand}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.price!==void 0&&t.price!==null&&e.jsxs("span",{className:"text-sm font-semibold",children:[t.price.toLocaleString()," ‚Ç∏"]}),t.category&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t.category})]})]})]})},t.id))})]})}),s.role==="user"&&e.jsx(p,{className:"h-8 w-8 border border-slate-200 bg-muted",children:$})]})},l)),e.jsx("div",{ref:h})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),y()},className:"flex gap-2 p-4 border-t border-slate-200 bg-white",children:[e.jsx(z,{value:d,onChange:s=>f(s.target.value),placeholder:"–í–∞—à –≤–æ–ø—Ä–æ—Å...",className:"flex-1",autoFocus:m}),e.jsx(x,{type:"submit",disabled:w||!d.trim(),className:"shrink-0",children:"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"})]})]}):e.jsx(x,{variant:"outline",size:"icon",className:"fixed bottom-6 right-6 z-40 shadow-md border bg-white md:bottom-6 md:right-6 bottom-[80px] right-6 md:bottom-6 sm:bottom-6 lg:bottom-6 xl:bottom-6",onClick:()=>b(!0),"aria-label":"–û—Ç–∫—Ä—ã—Ç—å —á–∞—Ç-—Å—Ç–∏–ª–∏—Å—Ç",children:e.jsx(B,{className:"w-6 h-6 text-muted-foreground"})})};export{W as default};
