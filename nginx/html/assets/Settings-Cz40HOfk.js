import{j as e}from"./ui-Cqf_O7uz.js";import{r as f,f as H}from"./router-YsGj19cs.js";import{g as X,u as q,d as G,a as J,b as K}from"./profile-Cn2hkh5a.js";import{B as A}from"./button-D4DJKXVl.js";import{I as u}from"./input-CPWPjeQo.js";import{L as m}from"./label-DMmfaKU4.js";import{T as E}from"./textarea-CvwRPQ_V.js";import{u as Q}from"./use-toast-aHRkQ04f.js";import{u as V}from"./index-DUoZO1f1.js";import{D as Y,a as ee,b as se,c as $}from"./dropdown-menu-Rti6Aa4h.js";import{c as L}from"./createLucideIcon-BcwDLXBm.js";import{I as te}from"./info-DtijYQbe.js";import{C as ae,a as re}from"./circle-x-DfXG8zVP.js";import{L as C}from"./loader-circle-yzSCNo-f.js";import{m as ie}from"./proxy-kgKBpva2.js";import{T as O}from"./trash-2-BP15ZqUs.js";import{U as T}from"./upload-CEja7h-0.js";import{L as ne}from"./link-CS_HXgaU.js";import{S as oe}from"./save-CC2lNIMm.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./chevron-right-CLAbP_dx.js";import"./check-Jm2HgjeV.js";/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=L("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=L("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=L("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),me=({className:_="",showDetails:d=!1})=>{const[c,j]=f.useState({isInstalled:!1,isOnline:navigator.onLine,hasServiceWorker:!1,hasNotifications:!1,hasPushManager:!1});f.useEffect(()=>{const p=()=>{const g=window.matchMedia("(display-mode: standalone)").matches,M=window.navigator.standalone===!0,b="serviceWorker"in navigator,N="Notification"in window,a="PushManager"in window;j({isInstalled:g||M,isOnline:navigator.onLine,hasServiceWorker:b,hasNotifications:N,hasPushManager:a})};p();const v=()=>j(g=>({...g,isOnline:!0})),x=()=>j(g=>({...g,isOnline:!1})),k=()=>p();return window.addEventListener("online",v),window.addEventListener("offline",x),window.matchMedia("(display-mode: standalone)").addEventListener("change",k),()=>{window.removeEventListener("online",v),window.removeEventListener("offline",x),window.matchMedia("(display-mode: standalone)").removeEventListener("change",k)}},[]);const r=p=>p?e.jsx(ae,{className:"w-4 h-4 text-green-500"}):e.jsx(re,{className:"w-4 h-4 text-red-500"}),l=(p,v,x)=>p?v:x;return d?e.jsxs("div",{className:`bg-gray-50 rounded-lg p-4 space-y-3 ${_}`,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:"Статус PWA"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Установка приложения:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:l(c.isInstalled,"Установлено","Не установлено")}),r(c.isInstalled)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Подключение к интернету:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[c.isOnline?e.jsx(le,{className:"w-4 h-4 text-green-500"}):e.jsx(de,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm",children:l(c.isOnline,"Онлайн","Офлайн")})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Service Worker:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:l(c.hasServiceWorker,"Поддерживается","Не поддерживается")}),r(c.hasServiceWorker)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Уведомления:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:l(c.hasNotifications,"Поддерживаются","Не поддерживаются")}),r(c.hasNotifications)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Push уведомления:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm",children:l(c.hasPushManager,"Поддерживаются","Не поддерживаются")}),r(c.hasPushManager)]})]})]})]}):e.jsxs("div",{className:`flex items-center space-x-2 text-sm ${_}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:c.isInstalled?"Установлено":"Не установлено"}),r(c.isInstalled)]})},he={avatar:"",first_name:"",last_name:"",phone_number:"",date_of_birth:"",height:void 0,weight:void 0,chest:void 0,waist:void 0,hips:void 0,favorite_colors:"",favorite_brands:""},$e=()=>{const _=H(),{toast:d}=Q(),{logout:c,updateUser:j}=V(),[r,l]=f.useState(he),[p,v]=f.useState(!0),[x,k]=f.useState(!1),[g,M]=f.useState(!1),[b,N]=f.useState(!1),[a,F]=f.useState({}),W=f.useRef(null);f.useEffect(()=>{(async()=>{try{const s=await X();l({avatar:s.avatar||"",first_name:s.first_name||"",last_name:s.last_name||"",phone_number:s.phone_number||"",date_of_birth:s.date_of_birth||"",height:s.height,weight:s.weight,chest:s.chest,waist:s.waist,hips:s.hips,favorite_colors:Array.isArray(s.favorite_colors)?s.favorite_colors.join(", "):s.favorite_colors||"",favorite_brands:Array.isArray(s.favorite_brands)?s.favorite_brands.join(", "):s.favorite_brands||""})}catch{d({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить профиль"})}finally{v(!1)}})()},[d]);const P=(i,s)=>{switch(i){case"first_name":case"last_name":if(s&&s.trim()){const t=s.trim();if(t.length>50)return"Не более 50 символов";if(!/^[a-zA-Zа-яА-Я\s-]+$/.test(t))return"Только буквы, пробелы и дефисы"}break;case"phone_number":if(s&&s.trim()&&!/^\+?[0-9]{7,15}$/.test(s))return"Формат: +77071234567";break;case"height":if(s!==void 0&&s!==""&&s!==null){const t=Number(s);if(isNaN(t)||t<=0)return"Должно быть положительным числом";if(t>300)return"Не более 300 см"}break;case"weight":if(s!==void 0&&s!==""&&s!==null){const t=Number(s);if(isNaN(t)||t<=0)return"Должно быть положительным числом";if(t>500)return"Не более 500 кг"}break;case"chest":case"waist":case"hips":if(s!==void 0&&s!==""&&s!==null){const t=Number(s);if(isNaN(t)||t<=0)return"Должно быть положительным числом";if(t>200)return"Не более 200 см"}break;case"date_of_birth":if(s&&s.trim()){const t=new Date(s);if(isNaN(t.getTime()))return"Некорректная дата";const n=new Date;if(n.setHours(0,0,0,0),t>n)return"Не может быть в будущем";const h=(n.getTime()-t.getTime())/(1e3*60*60*24*365.25);if(h<13)return"Минимум 13 лет";if(h>120)return"Некорректная дата"}break;case"avatar":if(s&&s.trim()){const t=s.trim();if(!(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/")))return"Ссылка должна быть абсолютной (http://, https://) или начинаться с /"}break}return""},y=i=>{const{name:s,value:t}=i.target;l(h=>({...h,[s]:t}));const n=P(s,t);F(h=>({...h,[s]:n}))},S=i=>{const{name:s,value:t}=i.target,n=t===""?void 0:Number(t);if(n!==void 0&&n<0)return;l(w=>({...w,[s]:n}));const h=P(s,t);F(w=>({...w,[s]:h}))},z=async i=>{var n,h,w,D;if(i.preventDefault(),Object.values(a).some(o=>o!=="")){d({variant:"destructive",title:"Ошибки валидации",description:"Исправьте ошибки в полях формы"});return}const t={...r};typeof t.favorite_colors=="string"&&(t.favorite_colors=t.favorite_colors.split(",").map(o=>o.trim()).filter(o=>o!=="")),typeof t.favorite_brands=="string"&&(t.favorite_brands=t.favorite_brands.split(",").map(o=>o.trim()).filter(o=>o!=="")),k(!0);try{const o=await q(t);j(o),d({title:"Профиль обновлен"}),_("/profile")}catch(o){let I=((h=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:h.detail)||"Не удалось обновить профиль";Array.isArray((D=(w=o==null?void 0:o.response)==null?void 0:w.data)==null?void 0:D.detail)&&(I=o.response.data.detail.map(Z=>Z.msg).join(". ")),d({variant:"destructive",title:"Ошибка",description:I})}finally{k(!1)}},U=async()=>{if(confirm("Вы уверены, что хотите удалить аккаунт? Это действие необратимо.")){M(!0);try{await K(),await c(),_("/")}catch{d({variant:"destructive",title:"Ошибка",description:"Не удалось удалить аккаунт"})}finally{M(!1)}}},R=async i=>{if(!i.target.files||i.target.files.length===0)return;const s=i.target.files[0];N(!0);try{const t=await J(s);l(n=>({...n,avatar:t.avatar})),j(t),d({title:"Аватар обновлен"})}catch{d({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить аватар"})}finally{N(!1)}},B=async()=>{var i,s;if(r.avatar&&confirm("Удалить аватар?")){N(!0);try{const t=await G();l(n=>({...n,avatar:""})),j(t),d({title:"Аватар удален"})}catch(t){console.error("Error deleting avatar:",t);let n="Не удалось удалить аватар";(s=(i=t==null?void 0:t.response)==null?void 0:i.data)!=null&&s.detail&&(n=t.response.data.detail),d({variant:"destructive",title:"Ошибка",description:n})}finally{N(!1)}}};return p?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(ie.section,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"container mx-auto max-w-3xl px-4 py-12",children:[e.jsx("h1",{className:"mb-8 text-3xl font-bold tracking-tight text-foreground",children:"Настройки профиля"}),e.jsxs("form",{onSubmit:z,className:"space-y-8",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-foreground",children:"Основная информация"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"first_name",className:"text-sm font-medium text-muted-foreground",children:"Имя"}),e.jsx(u,{id:"first_name",name:"first_name",value:r.first_name||"",onChange:y,placeholder:"Имя",className:`focus:ring-1 focus:ring-primary ${a.first_name?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.first_name&&e.jsx("p",{className:"text-sm text-red-500",children:a.first_name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"last_name",className:"text-sm font-medium text-muted-foreground",children:"Фамилия"}),e.jsx(u,{id:"last_name",name:"last_name",value:r.last_name||"",onChange:y,placeholder:"Фамилия",className:`focus:ring-1 focus:ring-primary ${a.last_name?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.last_name&&e.jsx("p",{className:"text-sm text-red-500",children:a.last_name})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"phone_number",className:"text-sm font-medium text-muted-foreground",children:"Телефон"}),e.jsx(u,{id:"phone_number",name:"phone_number",value:r.phone_number||"",onChange:y,placeholder:"+77071234567",className:`focus:ring-1 focus:ring-primary ${a.phone_number?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.phone_number&&e.jsx("p",{className:"text-sm text-red-500",children:a.phone_number})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"date_of_birth",className:"text-sm font-medium text-muted-foreground",children:"Дата рождения"}),e.jsx(u,{id:"date_of_birth",name:"date_of_birth",type:"date",value:r.date_of_birth||"",onChange:y,className:`focus:ring-1 focus:ring-primary ${a.date_of_birth?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.date_of_birth&&e.jsx("p",{className:"text-sm text-red-500",children:a.date_of_birth})]}),e.jsxs("div",{className:"space-y-3 md:col-span-2 order-first",children:[e.jsx(m,{className:"text-sm font-medium text-muted-foreground",children:"Аватар"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative h-24 w-24 overflow-hidden rounded-full border",children:r.avatar?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r.avatar,alt:"avatar",className:"h-full w-full rounded-full object-cover"}),e.jsx("button",{type:"button",onClick:B,disabled:b,className:"absolute inset-0 flex items-center justify-center bg-black/60 opacity-0 hover:opacity-100 transition",children:b?e.jsx(C,{className:"h-6 w-6 animate-spin text-red-500"}):e.jsx(O,{className:"h-6 w-6 text-red-500"})})]}):e.jsx("div",{className:"flex h-full w-full items-center justify-center text-xs text-muted-foreground",children:"Нет"})}),e.jsx("input",{type:"file",accept:"image/*",ref:W,onChange:R,className:"hidden"}),e.jsxs(Y,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(A,{type:"button",variant:"outline",size:"sm",disabled:b,className:"flex items-center gap-2",children:[b?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:"Загрузить"})]})}),e.jsxs(se,{className:"w-40",children:[e.jsxs($,{onSelect:i=>{var s;i.preventDefault(),(s=W.current)==null||s.click()},className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"})," Файл"]}),e.jsxs($,{onSelect:i=>{i.preventDefault();const s=prompt("Введите URL изображения:");if(s){if(!/^https?:\/\//.test(s)){d({variant:"destructive",title:"Ошибка",description:"URL должен начинаться с http:// или https://"});return}l(t=>({...t,avatar:s}))}},className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"})," Ссылка"]})]})]})]})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-foreground",children:"Параметры тела"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"height",className:"text-sm font-medium text-muted-foreground",children:"Рост (см)"}),e.jsx(u,{id:"height",name:"height",type:"number",value:r.height??"",onChange:S,placeholder:"e.g. 180",className:`focus:ring-1 focus:ring-primary ${a.height?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.height&&e.jsx("p",{className:"text-sm text-red-500",children:a.height})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"weight",className:"text-sm font-medium text-muted-foreground",children:"Вес (кг)"}),e.jsx(u,{id:"weight",name:"weight",type:"number",value:r.weight??"",onChange:S,placeholder:"e.g. 75",className:`focus:ring-1 focus:ring-primary ${a.weight?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.weight&&e.jsx("p",{className:"text-sm text-red-500",children:a.weight})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"chest",className:"text-sm font-medium text-muted-foreground",children:"Грудь (см)"}),e.jsx(u,{id:"chest",name:"chest",type:"number",value:r.chest??"",onChange:S,placeholder:"e.g. 96",className:`focus:ring-1 focus:ring-primary ${a.chest?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.chest&&e.jsx("p",{className:"text-sm text-red-500",children:a.chest})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"waist",className:"text-sm font-medium text-muted-foreground",children:"Талия (см)"}),e.jsx(u,{id:"waist",name:"waist",type:"number",value:r.waist??"",onChange:S,placeholder:"e.g. 78",className:`focus:ring-1 focus:ring-primary ${a.waist?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.waist&&e.jsx("p",{className:"text-sm text-red-500",children:a.waist})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"hips",className:"text-sm font-medium text-muted-foreground",children:"Бедра (см)"}),e.jsx(u,{id:"hips",name:"hips",type:"number",value:r.hips??"",onChange:S,placeholder:"e.g. 100",className:`focus:ring-1 focus:ring-primary ${a.hips?"border-red-500 focus:border-red-500":"focus:border-primary"}`}),a.hips&&e.jsx("p",{className:"text-sm text-red-500",children:a.hips})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-foreground",children:"Предпочтения"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"favorite_colors",className:"text-sm font-medium text-muted-foreground",children:"Любимые цвета (через запятую)"}),e.jsx(E,{id:"favorite_colors",name:"favorite_colors",value:Array.isArray(r.favorite_colors)?r.favorite_colors.join(", "):r.favorite_colors||"",onChange:y,placeholder:"Красный, Черный, Белый",className:"resize-none focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(m,{htmlFor:"favorite_brands",className:"text-sm font-medium text-muted-foreground",children:"Любимые бренды (через запятую)"}),e.jsx(E,{id:"favorite_brands",name:"favorite_brands",value:Array.isArray(r.favorite_brands)?r.favorite_brands.join(", "):r.favorite_brands||"",onChange:y,placeholder:"Nike, Adidas, Zara",className:"resize-none focus:border-primary focus:ring-1 focus:ring-primary"})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-foreground",children:"Приложение"}),e.jsx(me,{showDetails:!0})]}),e.jsxs("div",{className:"flex justify-between gap-4",children:[e.jsxs(A,{type:"button",variant:"destructive",onClick:U,disabled:g,className:"flex items-center gap-2",children:[g?e.jsx(C,{className:"h-4 w-4 animate-spin"}):e.jsx(O,{className:"h-4 w-4"}),"Удалить аккаунт"]}),e.jsxs(A,{type:"submit",disabled:x,className:"flex items-center gap-2",children:[x&&e.jsx(C,{className:"h-4 w-4 animate-spin"}),!x&&e.jsx(oe,{className:"h-4 w-4"}),x?"Сохранение...":"Сохранить"]})]})]})]})};export{$e as default};
