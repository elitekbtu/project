import{j as e}from"./ui-Cqf_O7uz.js";import{r as t,u as re,L as V}from"./router-YsGj19cs.js";import{l as ie}from"./outfits-BAaSlPu9.js";import{B as C}from"./button-D4DJKXVl.js";import{I as _}from"./input-CPWPjeQo.js";import{C as W,d as B}from"./card-UwrtftrB.js";import{S as le,a as ne,b as ce,c as oe,d as A}from"./select-DOTyNBHD.js";import{S as me}from"./switch-XwiIomtp.js";import{P as de,a as ue,b as xe}from"./popover-BW8XCxM-.js";import{L}from"./label-DMmfaKU4.js";import{W as pe}from"./index-DUoZO1f1.js";import{m as j}from"./proxy-kgKBpva2.js";import{S as D}from"./search-DxfJQDsN.js";import{F as he}from"./filter-Cda4LJKM.js";import{S as U}from"./sparkles-Dhcxexd3.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./createLucideIcon-BcwDLXBm.js";import"./check-Jm2HgjeV.js";const Fe=()=>{const[x,$]=t.useState([]),[p,P]=t.useState(!0),[v,O]=t.useState(!1),[r,I]=t.useState(""),[h,R]=t.useState(1),[y,T]=t.useState(!0),[i,z]=t.useState(void 0),[m,H]=t.useState(""),[d,K]=t.useState(""),[N,G]=t.useState(!1),[J,Q]=t.useState(!1),M=re(),b=new URLSearchParams(M.search).get("style"),w=new URLSearchParams(M.search).get("brand");let u="Образы — TRC",l="Готовые модные образы, подборки и вдохновение на платформе TRC.",f="образы, стиль, мода, подборки, вдохновение, TRC";b?(u=`Образы в стиле: ${b} — TRC`,l=`Образы и подборки в стиле «${b}» на TRC.`,f+=`, стиль, ${b}`):i&&(u=`Образы в стиле: ${i} — TRC`,l=`Образы и подборки в стиле «${i}» на TRC.`,f+=`, стиль, ${i}`),w&&(u=`Бренд: ${w} — Образы — TRC`,l=`Образы с товарами бренда «${w}» на TRC.`,f+=`, бренд, ${w}`),r&&(u=`Поиск: ${r} — Образы — TRC`,l=`Результаты поиска по запросу «${r}» среди образов на TRC.`,f+=`, поиск, ${r}`),(m||d)&&(l+=` Цена: ${m||"от"} — ${d||"до"}.`);const X=Array.from(new Set(x.map(s=>s.style).filter(Boolean))),E=async(s,a,n,g,k,se)=>{const F={page:s};a!=null&&a!==""&&(F.q=a);let c=await ie(F);return n&&n!=="all"&&(c=c.filter(o=>o.style===n)),se&&(c=c.filter(o=>typeof o.total_price=="number")),(g||k)&&(c=c.filter(o=>{if(typeof o.total_price!="number")return!1;const te=g?parseFloat(g):0,ae=k?parseFloat(k):1/0;return o.total_price>=te&&o.total_price<=ae})),c};t.useEffect(()=>{P(!0),$([]),T(!0),R(1),E(1,r,i,m,d,N).then(s=>{$(s),T(s.length===20),P(!1)})},[r,i,m,d,N]),t.useEffect(()=>{h!==1&&(O(!0),E(h,r,i,m,d,N).then(s=>{$(a=>[...a,...s]),T(s.length===20),O(!1)}))},[h]);const Y=s=>{s.preventDefault(),I(r)},S=t.useRef(null),Z=t.useCallback(s=>{p||y&&(S.current&&S.current.disconnect(),S.current=new IntersectionObserver(a=>{a[0].isIntersecting&&R(n=>n+1)}),s&&S.current.observe(s))},[p,y]),q={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},ee={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return p?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((s,a)=>e.jsxs(W,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-[3/4] animate-pulse bg-muted"}),e.jsxs(B,{className:"p-4 space-y-2",children:[e.jsx("div",{className:"h-4 w-2/3 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-muted"})]})]},a))})}):e.jsxs(e.Fragment,{children:[e.jsxs(pe,{children:[e.jsx("title",{children:u}),e.jsx("meta",{name:"description",content:l}),e.jsx("meta",{name:"keywords",content:f}),e.jsx("meta",{property:"og:title",content:u}),e.jsx("meta",{property:"og:description",content:l})]}),e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-8",children:[e.jsx("h1",{className:"mb-4 font-display text-3xl font-bold tracking-tight",children:"Образы"}),e.jsx("p",{className:"text-muted-foreground",children:"Подберите готовый лук или вдохновитесь идеями наших стилистов."})]}),e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between w-full",children:[e.jsxs("form",{onSubmit:Y,className:"flex w-full max-w-md items-center gap-2 order-1 sm:order-none",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(D,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(_,{placeholder:"Поиск образов...",value:r,onChange:s=>I(s.target.value),className:"pl-10"})]}),e.jsx(C,{type:"submit",size:"icon",children:e.jsx(D,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto items-stretch sm:items-center justify-end order-2 sm:order-none",children:[e.jsxs(de,{open:J,onOpenChange:Q,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(C,{variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(he,{className:"h-4 w-4"}),"Фильтры"]})}),e.jsx(xe,{className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(L,{className:"mb-1 block",children:"Стиль"}),e.jsxs(le,{value:i||"",onValueChange:s=>z(s===""||s==="all"?void 0:s),children:[e.jsx(ne,{children:e.jsx(ce,{placeholder:"Все стили"})}),e.jsxs(oe,{children:[e.jsx(A,{value:"all",children:"Все стили"}),X.map(s=>e.jsx(A,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(L,{htmlFor:"only-price-switch",children:"Только с ценой"}),e.jsx(me,{id:"only-price-switch",checked:N,onCheckedChange:G})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"block",children:"Цена"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(_,{placeholder:"От",value:m,onChange:s=>H(s.target.value),type:"number",min:"0"})}),e.jsx("div",{className:"flex-1",children:e.jsx(_,{placeholder:"До",value:d,onChange:s=>K(s.target.value),type:"number",min:"0"})})]})]})]})})]}),e.jsx(V,{to:"/outfits/new",className:"w-full sm:w-auto",children:e.jsxs(C,{className:"flex items-center gap-2 bg-primary hover:bg-primary/90 w-full sm:w-auto",children:[e.jsx(U,{className:"h-4 w-4"}),"Создать образ"]})})]})]}),x.length>0?e.jsx(j.div,{variants:q,initial:"hidden",animate:"visible",className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map((s,a)=>{const n=a===x.length-1?{ref:Z}:{};return e.jsx(j.div,{variants:ee,...n,children:e.jsx(W,{className:"group overflow-hidden transition-all hover:shadow-lg rounded-lg",children:e.jsxs(V,{to:`/outfits/${s.id}`,children:[e.jsx("div",{className:"relative aspect-[3/4] overflow-hidden",children:s.image_url?e.jsx("img",{src:s.image_url.startsWith("/")?`${window.location.origin}${s.image_url}`:s.image_url,alt:s.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105",onError:g=>{console.error("Ошибка загрузки изображения образа:",s.image_url),g.currentTarget.src="/maneken.png"}}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted",children:e.jsx("img",{src:"/maneken.png",alt:"Манекен",className:"h-2/3 w-2/3 object-contain opacity-70"})})}),e.jsxs(B,{className:"p-3 sm:p-4 space-y-1",children:[e.jsx("h3",{className:"font-medium leading-tight text-base sm:text-lg",title:s.name,children:s.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Стиль: ",s.style]}),s.total_price&&e.jsxs("p",{className:"font-semibold text-sm sm:text-base",children:[s.total_price.toLocaleString()," ₸"]})]})]})})},s.id)})}):e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"py-16 text-center",children:[e.jsx(U,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 font-display text-xl font-semibold",children:"Образы не найдены"}),e.jsx("p",{className:"text-muted-foreground",children:"Попробуйте изменить запрос или создайте собственный лук!"})]}),v&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Загрузка..."})]})}),!p&&!v&&!y&&x.length>0&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Больше образов нет"})}),!p&&y&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(C,{onClick:()=>R(s=>s+1),disabled:v,variant:"outline",children:v?"Загрузка...":`Загрузить ещё (${h} → ${h+1})`})})]})]})};export{Fe as default};
