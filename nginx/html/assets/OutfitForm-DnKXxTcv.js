import{j as e}from"./ui-DmaJfU4R.js";import{f as _,g as w,r as d}from"./router-YsGj19cs.js";import{g as k,u as I,f as C}from"./outfits-5_GSKzeO.js";import{B as h}from"./button-CEL2MslA.js";import{I as x}from"./input-DSjIL0vM.js";import{T as S}from"./textarea-x4CJyvYj.js";import{L as l}from"./label-BnZhCuKw.js";import{u as O}from"./use-toast-BimaNeed.js";import{c as D}from"./utils-CytzSlOG.js";import{L as g}from"./loader-circle-yzSCNo-f.js";import{m as F}from"./proxy-OF6tZF67.js";import{A as L}from"./arrow-left-CZ8lUGg0.js";import{S as A}from"./save-CC2lNIMm.js";import"./vendor-BtP0CW_r.js";import"./index-8jId_CL5.js";import"./index-BwobEAja.js";import"./createLucideIcon-BcwDLXBm.js";const E={name:"",style:"",description:"",top_ids:[],bottom_ids:[],footwear_ids:[],accessories_ids:[],fragrances_ids:[]},Z=()=>{const u=_(),{id:n}=w(),{toast:i}=O(),m=!!n,[r,p]=d.useState(E),[b,j]=d.useState(!0),[c,y]=d.useState(!1);d.useEffect(()=>{(async()=>{try{if(m){const t=await k(Number(n));p({name:t.name,style:t.style,description:t.description??"",top_ids:(t.top||[]).map(s=>s.id),bottom_ids:(t.bottom||[]).map(s=>s.id),footwear_ids:(t.footwear||[]).map(s=>s.id),accessories_ids:(t.accessory||[]).map(s=>s.id),fragrances_ids:(t.fragrance||[]).map(s=>s.id)})}}catch{i({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить данные об образе"})}finally{j(!1)}})()},[n,m,i]);const f=a=>{const{name:t,value:s}=a.target;p(o=>({...o,[t]:s}))},v=(a,t)=>{const s=t.split(",").map(o=>o.trim()).filter(Boolean).map(Number);p(o=>({...o,[a]:s}))},N=async a=>{if(a.preventDefault(),!r.name.trim()||!r.style.trim()){i({variant:"destructive",title:"Ошибка",description:"Название и стиль обязательны"});return}if(![r.top_ids,r.bottom_ids,r.footwear_ids,r.accessories_ids,r.fragrances_ids].some(s=>s&&s.length>0)){i({variant:"destructive",title:"Ошибка",description:"Добавьте хотя бы один элемент в образ"});return}y(!0);try{const s={...r};if(m){const o=s;await I(Number(n),o),i({title:"Успешно",description:"Образ успешно обновлен"})}else await C(s),i({title:"Успешно",description:"Образ успешно создан"});u("/admin/outfits")}catch{i({variant:"destructive",title:"Ошибка",description:"Произошла ошибка при сохранении"})}finally{y(!1)}};return b?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"container mx-auto max-w-3xl px-4 py-8",children:[e.jsxs("div",{className:"mb-8 flex items-center gap-4",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>u("/admin/outfits"),className:"shrink-0 hover:bg-accent/50",children:e.jsx(L,{className:"h-5 w-5"})}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:m?"Редактирование образа":"Создание нового образа"})]}),e.jsxs("form",{onSubmit:N,className:"space-y-6",children:[e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-foreground",children:"Основная информация"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{htmlFor:"name",className:"text-sm font-medium text-muted-foreground",children:"Название*"}),e.jsx(x,{id:"name",name:"name",value:r.name,onChange:f,required:!0,placeholder:"Название образа",className:"focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{htmlFor:"style",className:"text-sm font-medium text-muted-foreground",children:"Стиль*"}),e.jsx(x,{id:"style",name:"style",value:r.style,onChange:f,required:!0,placeholder:"Стиль образа",className:"focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(l,{htmlFor:"description",className:"text-sm font-medium text-muted-foreground",children:"Описание"}),e.jsx(S,{id:"description",name:"description",value:r.description||"",onChange:f,placeholder:"Описание образа",rows:4,className:"min-h-[120px] focus:border-primary focus:ring-1 focus:ring-primary"})]})]})]}),e.jsxs("div",{className:"rounded-xl border bg-card p-6 shadow-sm",children:[e.jsx("h2",{className:"mb-6 text-xl font-semibold text-foreground",children:"Состав образа"}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:[{key:"top_ids",label:"ID верха"},{key:"bottom_ids",label:"ID низа"},{key:"footwear_ids",label:"ID обуви"},{key:"accessories_ids",label:"ID аксессуаров"},{key:"fragrances_ids",label:"ID ароматов"}].map(a=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs(l,{htmlFor:a.key,className:"text-sm font-medium text-muted-foreground",children:[a.label," (через запятую)"]}),e.jsx(x,{id:a.key,value:(r[a.key]??[]).join(", "),onChange:t=>v(a.key,t.target.value),placeholder:"Например: 123, 456, 789",className:"focus:border-primary focus:ring-1 focus:ring-primary"})]},a.key))})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>u("/admin/outfits"),className:"border-muted-foreground/30 hover:bg-muted/50",children:"Отмена"}),e.jsxs(h,{type:"submit",disabled:c,className:"bg-primary hover:bg-primary/90",children:[c&&e.jsx(g,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx(A,{className:D("h-4 w-4",!c&&"mr-2")}),c?"Сохранение...":"Сохранить"]})]})]})]})};export{Z as default};
