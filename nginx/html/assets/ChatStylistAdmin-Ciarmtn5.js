import{j as s}from"./ui-DmaJfU4R.js";import{r as n}from"./router-YsGj19cs.js";import{C as a,a as r,b as l,d as i,c as C}from"./card-hWJdfOrY.js";import{B as f}from"./button-CEL2MslA.js";import{B as p}from"./badge-CMy5sMNA.js";import{I as _}from"./input-DSjIL0vM.js";import{L as A}from"./label-BnZhCuKw.js";import{u as B}from"./use-toast-BimaNeed.js";import{g as S,c as k,a as T}from"./chatStylist-BhXqis4H.js";import{R as H}from"./refresh-cw-uUutlnOJ.js";import{A as D}from"./activity-CSq0x9O0.js";import{C as F,a as M}from"./circle-x-DfXG8zVP.js";import{T as E}from"./triangle-alert-NRRLLGg1.js";import{B as L}from"./bar-chart-3-BxCnkcx5.js";import{T as N}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./utils-CytzSlOG.js";import"./index-BwobEAja.js";import"./index-8jId_CL5.js";import"./createLucideIcon-BcwDLXBm.js";const as=()=>{const[t,g]=n.useState(null),[d,v]=n.useState(null),[b,h]=n.useState(!0),[j,u]=n.useState(!1),[m,y]=n.useState(24),{toast:x}=B();n.useEffect(()=>{o()},[]);const o=async()=>{h(!0);try{const[e,c]=await Promise.all([S(),k()]);g(e),v(c)}catch(e){console.error("Ошибка загрузки данных:",e),x({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить данные системы агентов"})}finally{h(!1)}},w=async()=>{u(!0);try{const e=await T(m);x({title:"Очистка завершена",description:e.message}),await o()}catch(e){console.error("Ошибка очистки:",e),x({variant:"destructive",title:"Ошибка",description:"Не удалось выполнить очистку"})}finally{u(!1)}};return b?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Управление ИИ-стилистом"}),s.jsx("p",{className:"text-muted-foreground",children:"Мониторинг и управление системой агентов"})]}),s.jsxs(f,{onClick:o,variant:"outline",children:[s.jsx(H,{className:"w-4 h-4 mr-2"}),"Обновить"]})]}),s.jsxs(a,{children:[s.jsx(r,{children:s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(D,{className:"w-5 h-5"}),"Состояние системы"]})}),s.jsx(i,{children:d?s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(p,{variant:d.status==="healthy"?"default":"destructive",children:[d.status==="healthy"?s.jsx(F,{className:"w-4 h-4 mr-1"}):s.jsx(M,{className:"w-4 h-4 mr-1"}),d.status==="healthy"?"Работает":"Ошибка"]}),s.jsx("span",{className:"text-sm text-muted-foreground",children:d.message})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(E,{className:"w-4 h-4 text-yellow-500"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:"Состояние неизвестно"})]})})]}),t&&s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs(a,{children:[s.jsx(r,{className:"pb-2",children:s.jsx(l,{className:"text-sm font-medium",children:"Всего разговоров"})}),s.jsxs(i,{children:[s.jsx("div",{className:"text-2xl font-bold",children:t.total_conversations}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Успешных: ",t.successful_conversations]})]})]}),s.jsxs(a,{children:[s.jsx(r,{className:"pb-2",children:s.jsx(l,{className:"text-sm font-medium",children:"Успешность"})}),s.jsxs(i,{children:[s.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(t.success_rate*100),"%"]}),s.jsxs("p",{className:"text-xs text-muted-foreground",children:["Неудачных: ",t.failed_conversations]})]})]}),s.jsxs(a,{children:[s.jsx(r,{className:"pb-2",children:s.jsx(l,{className:"text-sm font-medium",children:"Среднее время"})}),s.jsxs(i,{children:[s.jsxs("div",{className:"text-2xl font-bold",children:[t.average_response_time.toFixed(2),"s"]}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Время обработки"})]})]}),s.jsxs(a,{children:[s.jsx(r,{className:"pb-2",children:s.jsx(l,{className:"text-sm font-medium",children:"Активные контексты"})}),s.jsxs(i,{children:[s.jsx("div",{className:"text-2xl font-bold",children:t.active_contexts}),s.jsx("p",{className:"text-xs text-muted-foreground",children:"Пользователей онлайн"})]})]})]}),(t==null?void 0:t.agent_stats)&&s.jsxs(a,{children:[s.jsx(r,{children:s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(L,{className:"w-5 h-5"}),"Статистика агентов"]})}),s.jsx(i,{children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(t.agent_stats).map(([e,c])=>s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium capitalize",children:e.replace("_"," ")}),s.jsx(p,{variant:"outline",className:"text-xs",children:c.requests_processed||0})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[s.jsx("span",{children:"Успешных:"}),s.jsx("span",{children:c.successful_requests||0})]}),s.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[s.jsx("span",{children:"Fallback:"}),s.jsx("span",{children:c.fallback_used||0})]}),s.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[s.jsx("span",{children:"Среднее время:"}),s.jsxs("span",{children:[(c.average_processing_time||0).toFixed(2),"s"]})]})]})]},e))})})]}),s.jsxs(a,{children:[s.jsxs(r,{children:[s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(N,{className:"w-5 h-5"}),"Очистка контекстов"]}),s.jsx(C,{children:"Удаление старых контекстов разговоров для освобождения памяти"})]}),s.jsxs(i,{children:[s.jsxs("div",{className:"flex items-end gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(A,{htmlFor:"maxAge",children:"Максимальный возраст (часы)"}),s.jsx(_,{id:"maxAge",type:"number",value:m,onChange:e=>y(Number(e.target.value)),min:"1",max:"168",className:"w-32"})]}),s.jsxs(f,{onClick:w,disabled:j,variant:"destructive",children:[j?s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):s.jsx(N,{className:"w-4 h-4 mr-2"}),"Очистить"]})]}),s.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Будут удалены контексты старше ",m," часов"]})]})]})]})};export{as as default};
