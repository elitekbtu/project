import{j as e}from"./ui-DmaJfU4R.js";import{g as J,r as x,L as y}from"./router-YsGj19cs.js";import{u as K,b as X,a as Z,W as V,d as ee,e as se,f as L,c as M,g as ae}from"./index-8jId_CL5.js";import{B as d}from"./button-CEL2MslA.js";import{M as R,R as $}from"./RatingStars-BNNIPRxT.js";import{C as D,d as T,a as te}from"./card-hWJdfOrY.js";import{B as k}from"./badge-CMy5sMNA.js";import{S as c}from"./skeleton-rVL-utXS.js";import{T as ie}from"./textarea-x4CJyvYj.js";import{I as re}from"./ImageCarousel-CuJkajh5.js";import{I as ne}from"./ItemImage-C9AFigSL.js";import{C as P}from"./constants-BN7_l00R.js";import{m as n}from"./proxy-OF6tZF67.js";import{S as q}from"./shopping-bag-Din1qLo_.js";import{C as B}from"./chevron-left-DxwJ_0o2.js";import{M as le}from"./minus-s3m42Kqg.js";import{P as oe}from"./plus-D0op2cnd.js";import{H as A}from"./heart-DyjZq6UA.js";import{T as de}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./createLucideIcon-BcwDLXBm.js";import"./star-Cx7l4Pfa.js";const De=()=>{const{id:r}=J(),{user:h,isAdmin:E}=K(),[a,F]=x.useState(null),[C,H]=x.useState([]),[O,S]=x.useState(!0),[p,g]=x.useState([]),[f,z]=x.useState(""),[_,I]=x.useState(),{isFavorite:b,toggleFavorite:W}=X(),{addItem:G}=Z(),[i,Q]=x.useState(null),[j,v]=x.useState(1);x.useEffect(()=>{(async()=>{try{if(!r)return;S(!0);const[t,l]=await Promise.all([M.get(`/api/items/${r}`),M.get(`/api/items/${r}/similar`)]);F(t.data),H(l.data);const m=await L(Number(r));g(m)}catch(t){console.error(t)}finally{S(!1)}})()},[r]);const U=async()=>{r&&await W(Number(r))},Y=async()=>{if(!(!r||!f.trim()))try{const s=await ae(Number(r),{content:f,rating:_});g([s,...p]),z(""),I(void 0)}catch(s){console.error(s)}};if(O)return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(c,{className:"h-6 w-24 rounded-full"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(c,{className:"aspect-square rounded-xl"})}),e.jsxs("div",{className:"w-full md:w-1/2 space-y-6",children:[e.jsx(c,{className:"h-9 w-3/4 rounded-lg"}),e.jsx(c,{className:"h-5 w-1/2 rounded-lg"}),e.jsx(c,{className:"h-7 w-1/4 rounded-lg"}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(c,{className:"h-4 w-full rounded-lg"}),e.jsx(c,{className:"h-4 w-4/5 rounded-lg"}),e.jsx(c,{className:"h-4 w-3/4 rounded-lg"})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(c,{className:"h-12 flex-1 rounded-lg"}),e.jsx(c,{className:"h-12 w-12 rounded-lg"})]})]})]})]});if(!a)return e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-16 text-center",children:[e.jsx(q,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-2xl font-semibold tracking-tight",children:"Товар не найден"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Возможно, товар был удален или перемещен"}),e.jsx(d,{asChild:!0,variant:"outline",className:"rounded-full",children:e.jsxs(y,{to:"/items",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Вернуться в каталог"]})})]});const w=a.variants&&a.variants.length>0?Math.min(...a.variants.map(s=>typeof s.price=="number"?s.price:1/0)):void 0;let u;return(i==null?void 0:i.price)!==void 0&&(i==null?void 0:i.price)!==null?u=i.price:w!==void 0&&w!==1/0?u=w:a.price!==void 0&&a.price!==null&&(u=a.price),e.jsxs(e.Fragment,{children:[a&&e.jsxs(V,{children:[e.jsxs("title",{children:[a.name," — Купить в TRC"]}),e.jsx("meta",{name:"description",content:a.description||"Купить модную одежду в TRC. Большой выбор, быстрая доставка."}),e.jsx("meta",{name:"keywords",content:`мода, одежда, ${a.brand||""}, ${a.category||""}, купить`}),e.jsx("meta",{property:"og:title",content:a.name}),e.jsx("meta",{property:"og:description",content:a.description||""}),a.image_url&&e.jsx("meta",{property:"og:image",content:a.image_url})]}),e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-8",children:[e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-6",children:e.jsx(d,{asChild:!0,variant:"ghost",className:"pl-0 hover:bg-transparent",children:e.jsxs(y,{to:"/items",className:"flex items-center text-sm text-muted-foreground hover:text-foreground",children:[e.jsx(B,{className:"mr-1 h-4 w-4"}),"Назад к каталогу"]})})}),e.jsxs("div",{className:"mb-16 flex flex-col md:flex-row gap-8 md:gap-12",children:[e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:a.image_urls&&a.image_urls.length>0?e.jsx(re,{images:a.image_urls,className:"rounded-xl shadow-sm",aspectClassName:"aspect-square"}):e.jsx("div",{className:"aspect-square overflow-hidden rounded-xl bg-muted shadow-sm",children:e.jsx(ne,{src:a.image_url,alt:a.name,className:"h-full w-full object-cover transition-transform duration-500 hover:scale-105",fallbackClassName:"flex aspect-square items-center justify-center rounded-xl bg-muted shadow-sm"})})}),e.jsxs(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:a.category&&e.jsx(k,{variant:"outline",className:"text-xs capitalize",children:P[a.category]??a.category})}),e.jsx("h1",{className:"mb-2 text-3xl font-bold tracking-tight",children:a.name}),a.brand&&e.jsx("p",{className:"mb-4 text-lg text-muted-foreground",children:a.brand}),u!==void 0&&e.jsxs("p",{className:"mb-6 text-2xl font-bold",children:[u.toLocaleString(),"₸"]}),(a.color||a.size||a.style||a.collection)&&e.jsxs("div",{className:"mb-6 grid grid-cols-1 sm:grid-cols-2 gap-2",children:[a.color&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Цвет"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.color})]}),a.size&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Размер"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.size})]}),a.style&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Стиль"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.style})]}),a.collection&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2.5 border border-border/50 w-full sm:max-w-[260px]",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Коллекция"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.collection})]})]}),a.variants&&a.variants.length>0&&e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsx("h3",{className:"font-medium",children:"Выберите вариант"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3",children:a.variants.map(s=>{const t=[];s.size&&t.push(s.size),s.color&&t.push(s.color);const l=t.join(" ")||s.sku||String(s.id),m=(i==null?void 0:i.id)===s.id,o=s.stock!==void 0&&s.stock===0;return e.jsxs(d,{type:"button",variant:m?"default":"outline",size:"default",disabled:o,className:`flex flex-col items-start justify-between gap-1 rounded-xl border-2 px-3 py-3 transition-all duration-200 min-h-[84px] ${m?"border-primary shadow-sm":"border-transparent hover:border-muted-foreground/40"} ${o?"opacity-50 cursor-not-allowed":""}`,onClick:()=>{Q(s),v(1)},children:[e.jsx("span",{className:"font-medium leading-tight",children:l}),s.price!==void 0&&s.price!==null&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.price.toLocaleString(),"₸"]}),s.stock!==void 0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.stock>0?`${s.stock} шт.`:"Нет в наличии"})]},s.id)})}),i&&e.jsxs("div",{className:"flex items-center gap-4 pt-2",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Доступно: ",i.stock??"—"]}),e.jsxs("div",{className:"flex items-center gap-2 bg-muted rounded-lg p-1",children:[e.jsx(d,{variant:"ghost",size:"sm",disabled:j<=1,onClick:()=>v(s=>Math.max(1,s-1)),className:"h-8 w-8 rounded-md",children:e.jsx(le,{className:"h-3 w-3"})}),e.jsx("span",{className:"w-6 text-center font-medium",children:j}),e.jsx(d,{variant:"ghost",size:"sm",disabled:i.stock!==void 0&&j>=i.stock,onClick:()=>v(s=>i.stock!==void 0?Math.min(i.stock,s+1):s+1),className:"h-8 w-8 rounded-md",children:e.jsx(oe,{className:"h-3 w-3"})})]})]})]}),a.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-2 font-medium",children:"Описание"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:a.description})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(d,{size:"lg",className:"flex-1 rounded-lg shadow-sm hover:shadow-md transition-shadow",disabled:!i,onClick:()=>{!a||!i||G({id:i.id,item_id:a.id,name:a.name,price:i.price??a.price??0,image_url:a.image_url,size:i.size,color:i.color,quantity:j,stock:i.stock})},children:"Добавить в корзину"}),e.jsx(d,{size:"lg",variant:b(Number(r))?"default":"outline",className:"rounded-lg px-3 shadow-sm hover:shadow-md transition-shadow",onClick:U,children:e.jsx(A,{className:`h-5 w-5 ${b(Number(r))?"fill-current":""}`,strokeWidth:b(Number(r))?2:1.5})})]})]})]}),C.length>0&&e.jsxs(n.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},className:"mb-16",children:[e.jsx("h2",{className:"mb-6 text-2xl font-bold tracking-tight",children:"Похожие товары"}),e.jsx(n.div,{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:C.map(s=>e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsx(D,{className:"group overflow-hidden transition-all hover:shadow-lg border-0 shadow-sm",children:e.jsxs(y,{to:`/items/${s.id}`,className:"block",children:[e.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden",children:[(()=>{let t;if(s.variants&&s.variants.length>0){const o=s.variants.map(N=>N.price).filter(N=>typeof N=="number"&&N!==null);o.length>0&&(t=Math.min(...o))}t===void 0&&(t=s.price??void 0);const l=s.price&&t&&t<s.price,m=l?Math.round((s.price-t)/s.price*100):0;return l?e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsxs(k,{className:"bg-red-500 text-white text-xs font-bold",children:["-",m,"%"]})}):null})(),s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted",children:e.jsx(q,{className:"h-12 w-12 text-muted-foreground"})})]}),e.jsxs(T,{className:"p-4",children:[e.jsxs("div",{className:"mb-2",children:[s.category&&e.jsx(k,{variant:"outline",className:"mb-2 text-xs capitalize",children:P[s.category]??s.category}),e.jsx("h3",{className:"font-medium leading-tight line-clamp-1",title:s.name,children:s.name}),s.brand&&e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.brand})]}),(()=>{let t;if(s.variants&&s.variants.length>0){const m=s.variants.map(o=>o.price).filter(o=>typeof o=="number"&&o!==null);m.length>0&&(t=Math.min(...m))}t===void 0&&(t=s.price??void 0);const l=s.price&&t&&t<s.price;return l&&Math.round((s.price-t)/s.price*100),t!==void 0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"font-semibold",children:[t.toLocaleString()," ₸"]}),l&&e.jsxs("p",{className:"text-sm text-muted-foreground line-through",children:[s.price.toLocaleString()," ₸"]})]}):null})()]})]})})},s.id))})]}),e.jsxs(n.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.3},className:"mb-16",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Отзывы"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(R,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:p.length})]})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"mb-8 rounded-xl border p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-medium",children:"Оставить отзыв"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Ваша оценка"}),e.jsx($,{value:_,onChange:I})]}),e.jsx(ie,{placeholder:"Расскажите о вашем опыте использования этого товара...",value:f,onChange:s=>z(s.target.value),rows:4,className:"rounded-lg border-muted"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(d,{onClick:Y,disabled:!f.trim(),className:"rounded-lg",children:"Отправить отзыв"})})]})]}),p.length===0?e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"rounded-xl border p-8 text-center shadow-sm",children:[e.jsx(R,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-lg font-medium",children:"Пока нет отзывов"}),e.jsx("p",{className:"text-muted-foreground",children:"Будьте первым, кто оставит отзыв об этом товаре"})]}):e.jsx(n.ul,{className:"space-y-4",children:p.map(s=>e.jsx(n.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs(D,{className:"overflow-hidden border-0 shadow-sm",children:[e.jsx(te,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.user_name??"Пользователь"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]}),((h==null?void 0:h.id)===s.user_id||E)&&e.jsx(d,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 h-8 w-8 rounded-full",onClick:async()=>{if(r&&confirm("Удалить комментарий?"))try{await ee(Number(r),s.id),g(t=>t.filter(l=>l.id!==s.id))}catch(t){console.error(t)}},children:e.jsx(de,{className:"h-4 w-4"})})]})}),e.jsxs(T,{className:"pt-0",children:[s.rating!==void 0&&s.rating!==null&&e.jsx("div",{className:"mb-3",children:e.jsx($,{value:s.rating})}),e.jsx("p",{className:"mb-4 whitespace-pre-line text-muted-foreground",children:s.content}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(d,{variant:"ghost",size:"sm",className:"flex items-center gap-2 rounded-full",onClick:async()=>{if(!(!r||!h))try{await se(Number(r),s.id);const t=await L(Number(r));g(t)}catch(t){console.error(t)}},children:[e.jsx(A,{className:`h-4 w-4 ${s.likes>0?"fill-primary text-primary":""}`}),e.jsx("span",{children:s.likes})]})})]})]})},s.id))})]})]})]})};export{De as default};
