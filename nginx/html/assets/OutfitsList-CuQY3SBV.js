import{j as e}from"./ui-DmaJfU4R.js";import{r as t,u as re,L as _}from"./router-YsGj19cs.js";import{l as ie}from"./outfits-5_GSKzeO.js";import{B as j}from"./button-CEL2MslA.js";import{I as L}from"./input-DSjIL0vM.js";import{C as B,d as A}from"./card-hWJdfOrY.js";import{S as le,a as ne,b as ce,c as oe,d as D}from"./select-CDSW5Axw.js";import{S as me}from"./switch-DVYTxNX9.js";import{P as de,a as ue,b as xe}from"./popover-S1_DSqif.js";import{L as P}from"./label-BnZhCuKw.js";import{W as he}from"./index-8jId_CL5.js";import{m as v}from"./proxy-OF6tZF67.js";import{S as U}from"./search-DxfJQDsN.js";import{F as pe}from"./filter-Cda4LJKM.js";import{S as O}from"./sparkles-Dhcxexd3.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./chevron-down-B6Nw56k2.js";import"./createLucideIcon-BcwDLXBm.js";import"./check-Jm2HgjeV.js";const Ve=()=>{const[x,$]=t.useState([]),[h,I]=t.useState(!0),[y,M]=t.useState(!1),[r,E]=t.useState(""),[p,R]=t.useState(1),[N,T]=t.useState(!0),[i,z]=t.useState(void 0),[m,H]=t.useState(""),[d,K]=t.useState(""),[b,G]=t.useState(!1),[J,Q]=t.useState(!1),F=re(),w=new URLSearchParams(F.search).get("style"),S=new URLSearchParams(F.search).get("brand");let u="Мои образы — TRC",l="Ваши созданные образы и подборки на платформе TRC.",f="мои образы, стиль, мода, подборки, TRC";w?(u=`Мои образы в стиле: ${w} — TRC`,l=`Ваши образы и подборки в стиле «${w}» на TRC.`,f+=`, стиль, ${w}`):i&&(u=`Мои образы в стиле: ${i} — TRC`,l=`Ваши образы и подборки в стиле «${i}» на TRC.`,f+=`, стиль, ${i}`),S&&(u=`Бренд: ${S} — Мои образы — TRC`,l=`Ваши образы с товарами бренда «${S}» на TRC.`,f+=`, бренд, ${S}`),r&&(u=`Поиск: ${r} — Мои образы — TRC`,l=`Результаты поиска по запросу «${r}» среди ваших образов на TRC.`,f+=`, поиск, ${r}`),(m||d)&&(l+=` Цена: ${m||"от"} — ${d||"до"}.`);const X=Array.from(new Set(x.map(s=>s.style).filter(Boolean))),V=async(s,a,n,g,k,se)=>{const W={page:s};a!=null&&a!==""&&(W.q=a);let c=await ie(W);return n&&n!=="all"&&(c=c.filter(o=>o.style===n)),se&&(c=c.filter(o=>typeof o.total_price=="number")),(g||k)&&(c=c.filter(o=>{if(typeof o.total_price!="number")return!1;const te=g?parseFloat(g):0,ae=k?parseFloat(k):1/0;return o.total_price>=te&&o.total_price<=ae})),c};t.useEffect(()=>{I(!0),$([]),T(!0),R(1),V(1,r,i,m,d,b).then(s=>{$(s),T(s.length===20),I(!1)})},[r,i,m,d,b]),t.useEffect(()=>{p!==1&&(M(!0),V(p,r,i,m,d,b).then(s=>{$(a=>[...a,...s]),T(s.length===20),M(!1)}))},[p]);const Y=s=>{s.preventDefault(),E(r)},C=t.useRef(null),Z=t.useCallback(s=>{h||N&&(C.current&&C.current.disconnect(),C.current=new IntersectionObserver(a=>{a[0].isIntersecting&&R(n=>n+1)}),s&&C.current.observe(s))},[h,N]),q={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},ee={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}};return h?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:6}).map((s,a)=>e.jsxs(B,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-[3/4] animate-pulse bg-muted"}),e.jsxs(A,{className:"p-4 space-y-2",children:[e.jsx("div",{className:"h-4 w-2/3 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-3 w-1/3 animate-pulse rounded bg-muted"})]})]},a))})}):e.jsxs(e.Fragment,{children:[e.jsxs(he,{children:[e.jsx("title",{children:u}),e.jsx("meta",{name:"description",content:l}),e.jsx("meta",{name:"keywords",content:f}),e.jsx("meta",{property:"og:title",content:u}),e.jsx("meta",{property:"og:description",content:l})]}),e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-8",children:[e.jsx("h1",{className:"mb-4 font-display text-3xl font-bold tracking-tight",children:"Мои образы"}),e.jsx("p",{className:"text-muted-foreground",children:"Ваши созданные образы и подборки. Здесь отображаются только ваши собственные луки."})]}),e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mb-8 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between w-full",children:[e.jsxs("form",{onSubmit:Y,className:"flex w-full max-w-md items-center gap-2 order-1 sm:order-none",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(U,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(L,{placeholder:"Поиск образов...",value:r,onChange:s=>E(s.target.value),className:"pl-10"})]}),e.jsx(j,{type:"submit",size:"icon",children:e.jsx(U,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto items-stretch sm:items-center justify-end order-2 sm:order-none",children:[e.jsxs(de,{open:J,onOpenChange:Q,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(pe,{className:"h-4 w-4"}),"Фильтры"]})}),e.jsx(xe,{className:"w-64",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx(P,{className:"mb-1 block",children:"Стиль"}),e.jsxs(le,{value:i||"",onValueChange:s=>z(s===""||s==="all"?void 0:s),children:[e.jsx(ne,{children:e.jsx(ce,{placeholder:"Все стили"})}),e.jsxs(oe,{children:[e.jsx(D,{value:"all",children:"Все стили"}),X.map(s=>e.jsx(D,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{htmlFor:"only-price-switch",children:"Только с ценой"}),e.jsx(me,{id:"only-price-switch",checked:b,onCheckedChange:G})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"block",children:"Цена"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(L,{placeholder:"От",value:m,onChange:s=>H(s.target.value),type:"number",min:"0"})}),e.jsx("div",{className:"flex-1",children:e.jsx(L,{placeholder:"До",value:d,onChange:s=>K(s.target.value),type:"number",min:"0"})})]})]})]})})]}),e.jsx(_,{to:"/outfits/new",className:"w-full sm:w-auto",children:e.jsxs(j,{className:"flex items-center gap-2 bg-primary hover:bg-primary/90 w-full sm:w-auto",children:[e.jsx(O,{className:"h-4 w-4"}),"Создать образ"]})})]})]}),x.length>0?e.jsx(v.div,{variants:q,initial:"hidden",animate:"visible",className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:x.map((s,a)=>{const n=a===x.length-1?{ref:Z}:{};return e.jsx(v.div,{variants:ee,...n,children:e.jsx(B,{className:"group overflow-hidden transition-all hover:shadow-lg rounded-lg",children:e.jsxs(_,{to:`/outfits/${s.id}`,children:[e.jsx("div",{className:"relative aspect-[3/4] overflow-hidden",children:s.image_url?e.jsx("img",{src:s.image_url.startsWith("/")?`${window.location.origin}${s.image_url}`:s.image_url,alt:s.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105",onError:g=>{console.error("Ошибка загрузки изображения образа:",s.image_url),g.currentTarget.src="/maneken.png"}}):e.jsx("div",{className:"flex h-full w-full items-center justify-center bg-muted",children:e.jsx("img",{src:"/maneken.png",alt:"Манекен",className:"h-2/3 w-2/3 object-contain opacity-70"})})}),e.jsxs(A,{className:"p-3 sm:p-4 space-y-1",children:[e.jsx("h3",{className:"font-medium leading-tight text-base sm:text-lg",title:s.name,children:s.name}),e.jsxs("p",{className:"text-xs sm:text-sm text-muted-foreground",children:["Стиль: ",s.style]}),s.total_price&&e.jsxs("p",{className:"font-semibold text-sm sm:text-base",children:[s.total_price.toLocaleString()," ₸"]})]})]})})},s.id)})}):e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"py-16 text-center",children:[e.jsx(O,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 font-display text-xl font-semibold",children:"У вас пока нет образов"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Создайте свой первый образ и начните собирать стильные подборки!"}),e.jsx(j,{asChild:!0,className:"rounded-full",children:e.jsxs(_,{to:"/outfits/new",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Создать первый образ"]})})]}),y&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Загрузка..."})]})}),!h&&!y&&!N&&x.length>0&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Это все ваши образы"})}),!h&&N&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(j,{onClick:()=>R(s=>s+1),disabled:y,variant:"outline",children:y?"Загрузка...":`Загрузить ещё (${p} → ${p+1})`})})]})]})};export{Ve as default};
