import{j as e}from"./ui-DmaJfU4R.js";import{g as G,r as c,L as f}from"./router-YsGj19cs.js";import{u as J,a as K,W as Q,c as N}from"./index-dk87i_EB.js";import{d as V,a as X,b as S,t as Y,c as Z}from"./outfits-C5fD7Vbx.js";import{B as u}from"./button-CEL2MslA.js";import{T as ee}from"./textarea-x4CJyvYj.js";import{C as $,d as T,a as se}from"./card-hWJdfOrY.js";import{B as te}from"./badge-CMy5sMNA.js";import{S as d}from"./skeleton-rVL-utXS.js";import{M as z,R as O}from"./RatingStars-BNNIPRxT.js";import{categoryConfig as L}from"./OutfitBuilder-Btb_LZpw.js";import{I as ae}from"./ItemImage-C9AFigSL.js";import{m as n}from"./proxy-OF6tZF67.js";import{S as R}from"./shopping-cart-BlvFNc12.js";import{C as F}from"./chevron-left-DxwJ_0o2.js";import{H as I}from"./heart-DyjZq6UA.js";import{P as ie}from"./pencil-sRn5a90G.js";import{T as re}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./createLucideIcon-BcwDLXBm.js";import"./star-Cx7l4Pfa.js";import"./input-DSjIL0vM.js";import"./use-toast-BimaNeed.js";import"./search-DxfJQDsN.js";import"./arrow-left-CZ8lUGg0.js";import"./arrow-right-ovKko4mr.js";import"./x-DBAcYj4I.js";import"./shopping-bag-Din1qLo_.js";const Ee=()=>{const{id:i}=G(),{user:m,isAdmin:y}=J(),[a,E]=c.useState(null),[A,B]=c.useState(!0),[x,h]=c.useState([]),[p,w]=c.useState(""),[b,v]=c.useState(),[g,j]=c.useState(null),{addItem:D}=K(),[C,k]=c.useState(!1);c.useEffect(()=>{i&&(async()=>{try{const t=await N.get(`/api/outfits/${i}`);E(t.data);const r=await S(Number(i));h(r)}catch(t){console.error(t)}finally{B(!1)}})()},[i]),c.useEffect(()=>{(async()=>{if(!(!i||!m))try{const t=await N.get("/api/outfits/favorites");j(t.data.some(r=>r.id===Number(i)))}catch{}})()},[i,m]);const H=async()=>{if(!(!i||m===null)){j(s=>!s);try{await Y(Number(i))}catch(s){j(t=>!t),console.error(s)}}},M=async()=>{if(!(!i||!p.trim()))try{const s=await Z(Number(i),{content:p,rating:b});h([s,...x]),w(""),v(void 0)}catch(s){console.error(s)}},P=async()=>{if(a){k(!0);try{const s=[...a.tops||[],...a.bottoms||[],...a.footwear||[],...a.accessories||[],...a.fragrances||[]];await Promise.all(s.map(async t=>{try{const o=(await N.get(`/api/items/${t.id}`)).data,l=o.variants&&o.variants.length>0?o.variants[0]:void 0,W=(l==null?void 0:l.id)??t.id,U=(l==null?void 0:l.price)??o.price??0;await D({id:W,item_id:t.id,name:o.name,price:U,image_url:o.image_url,size:l==null?void 0:l.size,color:l==null?void 0:l.color,stock:l==null?void 0:l.stock,quantity:1})}catch(r){console.error(r)}}))}catch(s){console.error(s)}finally{k(!1)}}},_=c.useMemo(()=>a?L.map(s=>{const t=s.key,r=a[t],o=r&&r.length?r[0]:void 0;return(o==null?void 0:o.image_url)||null}):L.map(()=>null),[a]);if(A)return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx(d,{className:"h-6 w-24 rounded-full"})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"w-full md:w-1/2",children:e.jsx(d,{className:"aspect-[4/5] rounded-xl"})}),e.jsxs("div",{className:"w-full md:w-1/2 space-y-6",children:[e.jsx(d,{className:"h-9 w-3/4 rounded-lg"}),e.jsx(d,{className:"h-5 w-1/2 rounded-lg"}),e.jsx(d,{className:"h-7 w-1/4 rounded-lg"}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsx(d,{className:"h-4 w-full rounded-lg"}),e.jsx(d,{className:"h-4 w-4/5 rounded-lg"}),e.jsx(d,{className:"h-4 w-3/4 rounded-lg"})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx(d,{className:"h-12 flex-1 rounded-lg"}),e.jsx(d,{className:"h-12 w-12 rounded-lg"})]})]})]})]});if(!a)return e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-16 text-center",children:[e.jsx(R,{className:"mx-auto mb-4 h-16 w-16 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-2xl font-semibold tracking-tight",children:"Образ не найден"}),e.jsx("p",{className:"text-muted-foreground mb-6 max-w-md mx-auto",children:"Возможно, образ был удален или перемещен"}),e.jsx(u,{asChild:!0,variant:"outline",className:"rounded-full",children:e.jsxs(f,{to:"/outfits",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Вернуться к образам"]})})]});const q=[{label:"Верх",items:a.tops,key:"tops"},{label:"Низ",items:a.bottoms,key:"bottoms"},{label:"Обувь",items:a.footwear,key:"footwear"},{label:"Аксессуары",items:a.accessories,key:"accessories"},{label:"Ароматы",items:a.fragrances,key:"fragrances"}];return e.jsxs(e.Fragment,{children:[a&&e.jsxs(Q,{children:[e.jsxs("title",{children:[a.name," — Образ в TRC"]}),e.jsx("meta",{name:"description",content:a.description||"Уникальный модный образ на платформе TRC."}),e.jsx("meta",{name:"keywords",content:`мода, образ, стиль, ${a.style||""}, купить`}),e.jsx("meta",{property:"og:title",content:a.name}),e.jsx("meta",{property:"og:description",content:a.description||""})]}),e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"container mx-auto px-4 py-8",children:[e.jsx(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-6",children:e.jsx(u,{asChild:!0,variant:"ghost",className:"pl-0 hover:bg-transparent",children:e.jsxs(f,{to:"/outfits",className:"flex items-center text-sm text-muted-foreground hover:text-foreground",children:[e.jsx(F,{className:"mr-1 h-4 w-4"}),"Назад к образам"]})})}),e.jsxs("div",{className:"mb-16 flex flex-col gap-8 md:flex-row md:gap-12",children:[e.jsx(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:e.jsx("div",{className:"aspect-[4/5] relative overflow-hidden rounded-xl bg-muted shadow-sm border",children:a.tryon_image_url?e.jsx("img",{src:a.tryon_image_url.startsWith("/")?`${window.location.origin}${a.tryon_image_url}`:a.tryon_image_url,alt:"Виртуальная примерка",className:"absolute inset-0 w-full h-full object-cover",onError:s=>{console.error("Ошибка загрузки изображения виртуальной примерки:",a.tryon_image_url),s.currentTarget.style.display="none";const t=s.currentTarget.parentElement;t&&(t.innerHTML=`
                      <img src="/maneken.jpg" alt="Манекен" class="absolute inset-0 w-full h-full object-contain" />
                      ${_.map((r,o)=>r?`<img src="${r}" alt="layer" class="absolute inset-0 w-full h-full object-contain" style="z-index: ${o+1}" />`:"").join("")}
                    `)}}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/maneken.jpg",alt:"Манекен",className:"absolute inset-0 w-full h-full object-contain"}),_.map((s,t)=>s?e.jsx("img",{src:s,alt:"layer",className:"absolute inset-0 w-full h-full object-contain",style:{zIndex:t+1}},t):null)]})})}),e.jsxs(n.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6},className:"w-full md:w-1/2",children:[e.jsx("div",{className:"mb-4",children:e.jsx(te,{variant:"outline",className:"text-xs capitalize mb-4",children:"Образ"})}),e.jsx("h1",{className:"mb-2 text-2xl sm:text-3xl font-bold tracking-tight",children:a.name}),e.jsxs("div",{className:"mb-6 grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"rounded-md bg-muted/80 p-2 sm:p-2.5 border border-border/50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Стиль"}),e.jsx("p",{className:"text-sm font-medium leading-tight",children:a.style})]}),a.total_price&&e.jsxs("div",{className:"rounded-md bg-muted/80 p-2 sm:p-2.5 border border-border/50",children:[e.jsx("p",{className:"mb-1 text-xs font-semibold uppercase tracking-wider text-muted-foreground",children:"Стоимость"}),e.jsxs("p",{className:"text-sm font-medium leading-tight",children:[a.total_price.toLocaleString("ru-RU")," ₽"]})]})]}),a.description&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"mb-2 font-medium text-base sm:text-lg",children:"Описание"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed text-sm sm:text-base",children:a.description})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs(u,{size:"lg",className:"flex-1 rounded-lg shadow-sm hover:shadow-md transition-shadow w-full sm:w-auto",disabled:C,onClick:P,children:[e.jsx(R,{className:"mr-2 w-4 h-4"}),C?"Добавление...":"Добавить в корзину"]}),e.jsx(u,{size:"lg",variant:g?"default":"outline",className:"rounded-lg px-3 shadow-sm hover:shadow-md transition-shadow w-full sm:w-auto",onClick:H,children:e.jsx(I,{className:`h-5 w-5 ${g?"fill-current":""}`,strokeWidth:g?2:1.5})}),m&&(m.id===a.owner_id||y)&&e.jsx(u,{asChild:!0,size:"lg",variant:"outline",className:"rounded-lg px-3 shadow-sm hover:shadow-md transition-shadow w-full sm:w-auto",children:e.jsx(f,{to:`/outfits/${a.id}/edit`,children:e.jsx(ie,{className:"h-4 w-4"})})})]})]})]}),e.jsxs(n.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.2},className:"mb-16",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h2",{className:"text-2xl font-bold tracking-tight mb-2",children:"Состав образа"})}),e.jsx("div",{className:"space-y-12",children:q.map(s=>s.items.length>0&&e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"space-y-6",children:[e.jsx("h3",{className:"text-base sm:text-lg font-medium text-foreground uppercase tracking-wider border-l-4 border-primary pl-4",children:s.label}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4",children:s.items.map(t=>e.jsx(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.3},children:e.jsx($,{className:"group overflow-hidden transition-all hover:shadow-lg border-0 shadow-sm rounded-lg",children:e.jsxs(f,{to:`/items/${t.id}`,className:"block",children:[e.jsx("div",{className:"relative aspect-square overflow-hidden",children:e.jsx(ae,{src:t.image_url,alt:t.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105",fallbackClassName:"flex h-full w-full items-center justify-center bg-muted"})}),e.jsx(T,{className:"p-2 sm:p-3",children:e.jsx("h4",{className:"font-medium leading-tight line-clamp-2 text-xs sm:text-sm group-hover:text-primary transition-colors",title:t.name,children:t.name})})]})})},t.id))})]},s.key))})]}),e.jsxs(n.section,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6,delay:.3},className:"mb-16",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Отзывы"}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:x.length})]})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4},className:"mb-8 rounded-xl border p-6 shadow-sm",children:[e.jsx("h3",{className:"mb-4 text-lg font-medium",children:"Оставить отзыв"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-2 text-sm text-muted-foreground",children:"Ваша оценка"}),e.jsx(O,{value:b,onChange:v})]}),e.jsx(ee,{placeholder:"Поделитесь своим мнением об этом образе...",value:p,onChange:s=>w(s.target.value),rows:4,className:"rounded-lg border-muted"}),e.jsx("div",{className:"flex justify-end",children:e.jsx(u,{onClick:M,disabled:!p.trim(),className:"rounded-lg",children:"Отправить отзыв"})})]})]}),x.length===0?e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"rounded-xl border p-8 text-center shadow-sm",children:[e.jsx(z,{className:"mx-auto mb-4 h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mb-2 text-lg font-medium",children:"Пока нет отзывов"}),e.jsx("p",{className:"text-muted-foreground",children:"Будьте первым, кто оставит отзыв об этом образе"})]}):e.jsx(n.ul,{className:"space-y-4",children:x.map(s=>e.jsx(n.li,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:e.jsxs($,{className:"overflow-hidden border-0 shadow-sm",children:[e.jsx(se,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.user_name??"Пользователь"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(s.created_at).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})})]}),((m==null?void 0:m.id)===s.user_id||y)&&e.jsx(u,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-600 h-8 w-8 rounded-full",onClick:async()=>{if(i&&confirm("Удалить комментарий?"))try{await V(Number(i),s.id),h(t=>t.filter(r=>r.id!==s.id))}catch(t){console.error(t)}},children:e.jsx(re,{className:"h-4 w-4"})})]})}),e.jsxs(T,{className:"pt-0",children:[s.rating!==void 0&&s.rating!==null&&e.jsx("div",{className:"mb-3",children:e.jsx(O,{value:s.rating})}),e.jsx("p",{className:"mb-4 whitespace-pre-line text-muted-foreground",children:s.content}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(u,{variant:"ghost",size:"sm",className:"flex items-center gap-2 rounded-full",onClick:async()=>{if(!(!i||!m))try{await X(Number(i),s.id);const t=await S(Number(i));h(t)}catch(t){console.error(t)}},children:[e.jsx(I,{className:`h-4 w-4 ${s.likes>0?"fill-primary text-primary":""}`}),e.jsx("span",{children:s.likes})]})})]})]})},s.id))})]})]})]})};export{Ee as default};
