import{j as e}from"./ui-DmaJfU4R.js";import{g as V,r,u as G,L as R}from"./router-YsGj19cs.js";import{s as T}from"./shops-CMY5BXM_.js";import{C as L,d as E}from"./card-hWJdfOrY.js";import{I as K}from"./input-DSjIL0vM.js";import{B as b}from"./button-CEL2MslA.js";import{B as U}from"./badge-CMy5sMNA.js";import{b as W,W as Y}from"./index-dk87i_EB.js";import{I as J}from"./ImageCarousel-CuJkajh5.js";import{I as Q}from"./ItemImage-C9AFigSL.js";import{C as X}from"./constants-BN7_l00R.js";import{S as x}from"./skeleton-rVL-utXS.js";import{m as l}from"./proxy-OF6tZF67.js";import{C as Z}from"./chevron-left-DxwJ_0o2.js";import{S as k}from"./search-DxfJQDsN.js";import{H as q}from"./heart-DyjZq6UA.js";import{S as ee}from"./shopping-bag-Din1qLo_.js";import"./vendor-BtP0CW_r.js";import"./utils-CytzSlOG.js";import"./index-BwobEAja.js";import"./createLucideIcon-BcwDLXBm.js";const be=()=>{const{moderatorId:o}=V(),[f,g]=r.useState([]),[t,B]=r.useState(null),[m,j]=r.useState(!0),[_,w]=r.useState(!1),[n,C]=r.useState(""),[v,S]=r.useState(1),[I,N]=r.useState(!0),{isFavorite:D,toggleFavorite:M}=W(),P=G(),d=new URLSearchParams(P.search).get("brand");let p=t?`${t.name} — Магазин на TRC`:"Магазин — TRC",h=t?`Товары магазина «${t.name}» на платформе TRC.`:"Товары магазина на платформе TRC.",y=t?`магазин, ${t.name}, товары, TRC`:"магазин, товары, TRC";d&&(p=`Бренд: ${d} — ${t?t.name+" — ":""}Магазин — TRC`,h=`Товары бренда «${d}» в магазине${t?" «"+t.name+"»":""} на TRC.`,y+=`, бренд, ${d}`),n&&(p=`Поиск: ${n} — ${t?t.name+" — ":""}Магазин — TRC`,h=`Результаты поиска по запросу «${n}» в магазине${t?" «"+t.name+"»":""} на TRC.`,y+=`, поиск, ${n}`);const $=async(s,a)=>{if(!o)return[];const i={};return a!=null&&a!==""&&(i.q=a),(await T.getShopItems(parseInt(o),s,20,i)).items};r.useEffect(()=>{(async()=>{if(o)try{const a=await T.getShop(parseInt(o));B(a)}catch(a){console.error("Error fetching shop:",a)}})()},[o]),r.useEffect(()=>{j(!0),g([]),N(!0),S(1),$(1,n).then(s=>{g(s),N(s.length===20),j(!1)}).catch(()=>{j(!1)})},[n,o]),r.useEffect(()=>{v!==1&&(w(!0),$(v,n).then(s=>{g(a=>[...a,...s]),N(s.length===20),w(!1)}))},[v,o]);const A=s=>{s.preventDefault(),C(n)},u=r.useRef(null),F=r.useCallback(s=>{m||I&&(u.current&&u.current.disconnect(),u.current=new IntersectionObserver(a=>{a[0].isIntersecting&&S(i=>i+1)}),s&&u.current.observe(s))},[m,I]),z={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05}}},H={hidden:{opacity:0,y:20},visible:{opacity:1,y:0}},O=s=>{if(s.variants&&s.variants.length>0){const a=s.variants.map(i=>i.price).filter(i=>typeof i=="number");if(a.length>0)return Math.min(...a)}return s.price??void 0};return m&&!t?e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(x,{className:"h-6 w-24 rounded-full mb-4"}),e.jsx(x,{className:"h-9 w-48 mb-4"}),e.jsx(x,{className:"h-5 w-96"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(x,{className:"h-10 w-full max-w-md"})}),e.jsx("div",{className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:Array.from({length:8}).map((s,a)=>e.jsxs(L,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-[3/4] animate-pulse bg-muted"}),e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-5 w-2/3 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-4 w-1/2 animate-pulse rounded bg-muted"}),e.jsx("div",{className:"h-4 w-1/3 animate-pulse rounded bg-muted"})]})})]},a))})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Y,{children:[e.jsx("title",{children:p}),e.jsx("meta",{name:"description",content:h}),e.jsx("meta",{name:"keywords",content:y}),e.jsx("meta",{property:"og:title",content:p}),e.jsx("meta",{property:"og:description",content:h})]}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},className:"mb-6",children:e.jsx(b,{asChild:!0,variant:"ghost",className:"pl-0 hover:bg-transparent",children:e.jsxs(R,{to:"/shops",className:"flex items-center text-sm text-muted-foreground hover:text-foreground",children:[e.jsx(Z,{className:"mr-1 h-4 w-4"}),"Назад к магазинам"]})})}),t&&e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"mb-8",children:e.jsx("div",{className:"mb-4",children:e.jsx("h1",{className:"mb-2 font-display text-3xl font-bold tracking-tight",children:t.name})})}),e.jsx(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"mb-8",children:e.jsxs("form",{onSubmit:A,className:"flex w-full max-w-md items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(k,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(K,{placeholder:"Поиск товаров...",value:n,onChange:s=>C(s.target.value),className:"pl-10"})]}),e.jsx(b,{type:"submit",size:"icon",children:e.jsx(k,{className:"h-4 w-4"})})]})}),f.length>0?e.jsx(l.div,{variants:z,initial:"hidden",animate:"visible",className:"grid gap-6 sm:grid-cols-2 lg:grid-cols-4",children:f.map((s,a)=>{const i=a===f.length-1?{ref:F}:{};return e.jsx(l.div,{variants:H,...i,children:e.jsx(L,{className:"group overflow-hidden transition-all hover:shadow-lg",children:e.jsxs(R,{to:`/shops/${o}/items/${s.id}`,children:[e.jsxs("div",{className:"relative aspect-[3/4] overflow-hidden",children:[s.image_urls&&s.image_urls.length>0?e.jsx(J,{images:s.image_urls,className:"transition-transform duration-500 group-hover:scale-105"}):e.jsx(Q,{src:s.image_url,alt:s.name,className:"h-full w-full object-cover transition-transform duration-500 group-hover:scale-105",fallbackClassName:"h-full w-full"}),e.jsx("div",{className:"absolute top-3 right-3 opacity-0 transition-opacity group-hover:opacity-100",children:e.jsx(b,{size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full",onClick:async c=>{c.preventDefault(),await M(s.id)},children:e.jsx(q,{className:`h-4 w-4 ${D(s.id)?"fill-primary text-primary":""}`})})})]}),e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"mb-2",children:[s.category&&e.jsx(U,{variant:"outline",className:"mb-2 text-xs capitalize",children:X[s.category]??s.category}),e.jsx("h3",{className:"font-medium leading-tight",title:s.name,children:s.name}),s.brand&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.brand})]}),(()=>{const c=O(s);return c!==void 0?e.jsxs("p",{className:"font-semibold",children:[c.toLocaleString()," ₸"]}):null})()]})]})})},s.id)})}):m?null:e.jsxs(l.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.6},className:"text-center py-16",children:[e.jsx("div",{className:"mx-auto mb-6 flex h-24 w-24 items-center justify-center rounded-full bg-muted",children:e.jsx(ee,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"mb-2 text-xl font-semibold",children:"Товары не найдены"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:n?"Попробуйте изменить поисковый запрос":"В данном магазине пока нет товаров"})]}),_&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Загрузка..."})]})})]})]})};export{be as default};
