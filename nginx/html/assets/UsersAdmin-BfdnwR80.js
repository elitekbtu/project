import{j as e}from"./ui-Cqf_O7uz.js";import{r as s,L as P}from"./router-YsGj19cs.js";import{c as F}from"./index-DUoZO1f1.js";import{B as r}from"./button-D4DJKXVl.js";import{B as m}from"./badge-DZ0IvmWb.js";import{u as R}from"./use-toast-aHRkQ04f.js";import{S as q,a as Q,b as V,c as W,d as x}from"./select-DOTyNBHD.js";import"./switch-XwiIomtp.js";import{P as X,a as $,b as A}from"./popover-BW8XCxM-.js";import{L as G}from"./label-DMmfaKU4.js";import{I as J}from"./input-CPWPjeQo.js";import{L as I}from"./loader-circle-yzSCNo-f.js";import{m as U}from"./proxy-kgKBpva2.js";import{F as K}from"./filter-Cda4LJKM.js";import{C as Y}from"./circle-plus-C0p9U_YC.js";import{S as Z}from"./shield-BvU7hRXJ.js";import{S as ee}from"./star-Cx7l4Pfa.js";import{c as E}from"./createLucideIcon-BcwDLXBm.js";import{P as te}from"./pencil-sRn5a90G.js";import{T as se}from"./trash-2-BP15ZqUs.js";import"./vendor-BtP0CW_r.js";import"./index-BwobEAja.js";import"./utils-CytzSlOG.js";import"./check-Jm2HgjeV.js";/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=E("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.379.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=E("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),Ue=()=>{const[j,l]=s.useState([]),[v,N]=s.useState(!0),[w,b]=s.useState(!1),[h,n]=s.useState(1),[M,p]=s.useState(!0),[k,O]=s.useState(""),[c,T]=s.useState(""),[S,C]=s.useState(null),{toast:f}=R(),[a,L]=s.useState(void 0),[ie,le]=s.useState(!1),y=async(t=1,i=!1,d)=>{try{i?b(!0):N(!0);const o={page:t};d&&(o.q=d),a&&a!=="all"&&(o.role=a);const g=await F.get("/api/users/",{params:o});l(H=>i?[...H,...g.data]:g.data),p(g.data.length===20)}catch{f({variant:"destructive",title:"Ошибка",description:"Не удалось загрузить список пользователей"})}finally{N(!1),b(!1)}};s.useEffect(()=>{n(1),y(1,!1,c)},[c]),s.useEffect(()=>{n(1),l([]),p(!0),y(1,!1,c)},[a]),s.useEffect(()=>{h!==1&&y(h,!0,c)},[h]);const z=t=>{t.preventDefault(),n(1),l([]),p(!0),T(k)},B=async t=>{if(confirm("Вы уверены, что хотите удалить этого пользователя?")){C(t);try{await F.delete(`/api/users/${t}`),l(i=>i.filter(d=>d.id!==t)),f({title:"Успешно",description:"Пользователь успешно удален",className:"border-0 bg-green-500 text-white shadow-lg"})}catch{f({variant:"destructive",title:"Ошибка",description:"Не удалось удалить пользователя"})}finally{C(null)}}},D=()=>{L(void 0)},[_,u]=s.useState(!1);return v?e.jsx("div",{className:"flex h-64 items-center justify-center",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(U.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight text-foreground",children:"Управление пользователями"}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("form",{onSubmit:z,className:"flex gap-2 items-center",children:[e.jsx(J,{type:"text",placeholder:"Поиск по email...",value:k,onChange:t=>O(t.target.value)}),e.jsx(r,{type:"submit",children:"Поиск"}),e.jsxs(X,{open:_,onOpenChange:u,children:[e.jsx($,{asChild:!0,children:e.jsx(r,{type:"button",variant:a?"default":"outline",className:"h-10 min-w-[44px] px-2 flex items-center justify-center","aria-label":"Фильтры",children:e.jsx(K,{className:"h-5 w-5"})})}),e.jsxs(A,{align:"end",side:"right",className:"p-2 rounded-lg shadow-md border w-[110px] min-w-[110px] bg-white dark:bg-gray-900 flex flex-col gap-2",style:{minWidth:"110px",maxWidth:"160px"},children:[e.jsx(G,{className:"mb-1 block text-xs text-muted-foreground",children:"Роль"}),e.jsxs(q,{value:a||"all",onValueChange:t=>{L(t==="all"?void 0:t),u(!1)},children:[e.jsx(Q,{className:"h-8 text-xs",children:e.jsx(V,{placeholder:"Все роли"})}),e.jsxs(W,{children:[e.jsx(x,{value:"all",children:"Все"}),e.jsx(x,{value:"admin",children:"Админ"}),e.jsx(x,{value:"moderator",children:"Модер."}),e.jsx(x,{value:"user",children:"Польз."})]})]}),e.jsx("button",{className:"text-[11px] text-muted-foreground hover:text-primary transition self-end mt-1",type:"button",onClick:()=>{D(),u(!1)},children:"Сбросить"})]})]})]}),e.jsx(r,{asChild:!0,children:e.jsxs(P,{to:"/admin/users/new",className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Добавить пользователя"]})})]})]}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-gray-200 bg-white shadow-sm dark:border-gray-800 dark:bg-gray-950",children:e.jsxs("table",{className:"min-w-full text-left",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-sm font-medium text-gray-700 dark:text-gray-300",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-right text-sm font-medium text-gray-700 dark:text-gray-300",children:"Действия"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-800",children:j.length>0?j.map(t=>e.jsxs(U.tr,{initial:{opacity:0},animate:{opacity:1},className:"hover:bg-gray-50/50 dark:hover:bg-gray-900/50",children:[e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-900 dark:text-gray-100",children:t.id}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900 dark:text-gray-100",children:t.email}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[t.is_admin?e.jsxs(m,{variant:"default",className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsx("span",{children:"Админ"})]}):t.is_moderator?e.jsxs(m,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:"Модератор"})]}):e.jsx(m,{variant:"secondary",children:"Пользователь"}),e.jsx(m,{variant:t.is_active?"default":"destructive",className:"flex items-center gap-1",children:t.is_active?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-3 w-3"}),e.jsx("span",{children:"Активен"})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{children:"Неактивен"})]})})]})}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",asChild:!0,className:"border-gray-300 dark:border-gray-700",children:e.jsxs(P,{to:`/admin/users/${t.id}/edit`,className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3"}),e.jsx("span",{children:"Редактировать"})]})}),e.jsxs(r,{variant:"destructive",size:"sm",onClick:()=>B(t.id),disabled:S===t.id,className:"flex items-center gap-1",children:[S===t.id?e.jsx(I,{className:"h-3 w-3 animate-spin"}):e.jsx(se,{className:"h-3 w-3"}),e.jsx("span",{children:"Удалить"})]})]})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-8 text-center text-sm text-gray-500 dark:text-gray-400",children:"Нет зарегистрированных пользователей"})})})]})}),!v&&M&&e.jsx("div",{className:"flex justify-center my-4",children:e.jsx(r,{onClick:()=>n(t=>t+1),disabled:w,children:w?"Загрузка...":"Загрузить ещё"})})]})};export{Ue as default};
